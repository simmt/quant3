{
    "contents" : "#Figure 4.10\nlibrary(causalA16)\nlibrary(ggplot2)\nlibrary(data.table)\nset.seed(8)\ndata_for_figure_4_1 <- make_data_for_figure_4_1(1000)\ncalc_average_causal_effect_estimand(data_for_figure_4_1)\ncalc_naive_difference_in_means(data_for_figure_4_1)\ncalc_conditional_difference_in_means(data_for_figure_4_1, \"s\")\ncalc_conditional_difference_in_means(data_for_figure_4_1, \"x\")\n\nsimulations <- replicate(1000, {\n  data_for_figure_4_1 <- make_data_for_figure_4_1(1000)\n  c(calc_average_causal_effect_estimand(data_for_figure_4_1),\n    calc_naive_difference_in_means(data_for_figure_4_1),\n    calc_conditional_difference_in_means(data_for_figure_4_1, \"s\"),\n    calc_conditional_difference_in_means(data_for_figure_4_1, \"x\"))\n})\n?replicate\nsim_data <- data.table(t(simulations))\nsetnames(sim_data, c(\"ACE_estimand\",\n                     \"naive_diff_in_means\",\n                     \"diff_in_means_cond_s\",\n                     \"diff_in_means_cond_x\"))\nsim_data[, `:=`(\n  MAE_diff_in_means = abs(ACE_estimand - naive_diff_in_means),\n  MAE_diff_in_means_cond_s = abs(ACE_estimand - diff_in_means_cond_s),\n  MAE_diff_in_means_cond_x = abs(ACE_estimand - diff_in_means_cond_x)\n)]\n#melt turns wide to long... on big vector of values\n### . makes list of columns\nmelt_sim_data <- melt(sim_data[, .(MAE_diff_in_means, MAE_diff_in_means_cond_s,\n                                   MAE_diff_in_means_cond_x)])\n\nggplot(melt_sim_data, aes(y = value, x = variable)) +\n  geom_boxplot()\n\n#' Simulate data that corresponds to Figure 4.1 from MgW\n#'\n#' DETAILS\n#' @param n number of observations\n#' @param seed RNG seed\n#' @return data.table with potential outcomes\n#' @import data.table\n#' @export\nmake_data_for_figure_4_1 <- function(n,\n                                     seed = sample.int(.Machine$integer.max, 1))\n{\n  set.seed(seed)\n  \n  \n  u <- rbinom(n, 1, prob = .5)\n  s <- rbinom(n, 1, prob = plogis(-1 + 2 * u))\n  x <- rbinom(n, 1, prob = plogis(1 - 2 * u))\n  d <- rbinom(n, 1, prob = plogis(-3  + 6 * s))\n  y1 <- rbinom(n, 1, prob = plogis(-1 + 2 * 1 - 2 * x))\n  y0 <- rbinom(n, 1, prob = plogis(-1 + 2 * 0 - 2 * x))\n  \n  \n  y <- d * y1 + (1 - d) * y0\n  DATA <- data.table(y1, y0, y, u, s, x, d)\n  attr(DATA, \"seed\") <- seed\n  DATA\n}\n\n\n#' Calculate average causal effect estimand\n#'\n#' DETAIL\n#' @param DATA a dataset with potential outcomes named y0 and y1\n#' @return number\n#' @import data.table\n#' @export\ncalc_average_causal_effect_estimand <- function(DATA, conditioning_variable)\n{\n  DATA[, mean(y1 - y0)]\n}\n\n#' Calculate the naive difference in means\n#'\n#' Calculate the naive difference in means\n#' @param DATA a dataset, can't have a variable named \"Z\" in it\n#' @param conditioning_variable character object for variable name in DATA;\n#' assumed to be binary 0-1\n#' @return number\n#' @import data.table\n#' @export\ncalc_conditional_difference_in_means <- function(DATA, conditioning_variable)\n{\n  Z <- DATA[, conditioning_variable, with = FALSE]\n  p_Z_1 <- DATA[, mean(Z == 1)]\n  p_Z_0 <- DATA[, mean(Z == 0)]\n  mean_y_D_1_Z_1 <- DATA[, mean(y[d == 1 & Z == 1])]\n  mean_y_D_1_Z_0 <- DATA[, mean(y[d == 1 & Z == 0])]\n  mean_y_D_0_Z_1 <- DATA[, mean(y[d == 0 & Z == 1])]\n  mean_y_D_0_Z_0 <- DATA[, mean(y[d == 0 & Z == 0])]\n  \n  #mean_y_D_1_Z_1 <- DATA[[d == 1 & Z == 1], mean(y)]\n  #mean_y_D_1_Z_0 <- DATA[[d == 1 & Z == 0], mean(y)]\n  #mean_y_D_0_Z_1 <- DATA[[d == 0 & Z == 1], mean(y)]\n  #mean_y_D_0_Z_0 <- DATA[[d == 0 & Z == 0], mean(y)]\n  \n  (p_Z_1 * mean_y_D_1_Z_1 + p_Z_0 * mean_y_D_1_Z_0) -\n    (p_Z_1 * mean_y_D_0_Z_1 + p_Z_0 * mean_y_D_0_Z_0)\n}",
    "created" : 1473192793936.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "2953748163",
    "id" : "C5DFA6D9",
    "lastKnownWriteTime" : 7782326810552827906,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled4"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}