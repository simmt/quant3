{
    "contents" : "##############################\n####The Library of Babel######\n##############################\nlibrary(foreign)\nlibrary(plyr)\nlibrary(car)\nlibrary(psych)\nlibrary(stargazer)\nlibrary(xtable)\nlibrary(stats)\nlibrary(multilevel)\nlibrary(texreg)\nlibrary(ggplot2)\nlibrary(nlme)\n#############################\n#########DATASETS############\n#############################\n#begin with WVS....check at each point for dropped observations\n##Construct country aggregates for WVS; note that numeric \"scores\" need to be constructed from the survey responses\nWVS<-read.dta(\"/Users/Kevin/Downloads/WVS_Longitudinal_1981_2014_stata_v2015_04_18.dta\")\n##Note...try to preseve.. 66 cases\n##note quirk...S003A gives E/W Germany instead of S003's Germany\n#length(unique(WVS$S003[WVS$C008==\"3\"]))\n#####also, something weird with Bosnia...nonetheless, seems a quick rename solves\nWVS$S003[WVS$S003==\"Bosnia\"]<-\"Bosnia\"\n#unique(WVS$S003[WVS$C008==\"3\"])\n#summary(WVS$C008[WVS$S003==\"Bosnia\"])\n####now make a usuable numeric\nWVS$C008<-mapvalues(WVS$C008, from = c(\"It´s leisure that makes life worth living, not work\", \"2\", \"3\", \"4\", \"Work is what makes life worth living, not leisure\"), to = c(\"1\", \"2\", \"3\", \"4\", \"5\"))\n###Begin creation of file with Work Value scores\nWVS_Work_Leisure_Scores<-aggregate(as.numeric(as.character(WVS$C008[WVS$C008==\"1\"|WVS$C008==\"2\"|WVS$C008==\"3\"|WVS$C008==\"4\"|WVS$C008==\"5\"])), by=list(WVS$S003[WVS$C008==\"1\"|WVS$C008==\"2\"|WVS$C008==\"3\"|WVS$C008==\"4\"|WVS$C008==\"5\"]), FUN=mean, na.rm=TRUE)\n##This will be our cross-country work-ethic index: \"1:It´s leisure that makes life worth living, not work 2:2 3:3 4:4 5:Work is what makes life worth living, not leisure -5:Missing; Unknown -4:Not asked in survey -3:Not applicable -2:No answer -1:Don´t know\nWVS_Work_Leisure_Scores <- rename(WVS_Work_Leisure_Scores, c(Group.1=\"Country\", x=\"Work_Index\"))\nWVS_Work_Leisure_Scores<- WVS_Work_Leisure_Scores[order(WVS_Work_Leisure_Scores$Country),]\n\n###create index of four and five responses as proportion\nWVS_High<-aggregate(as.numeric(as.character(WVS$C008[WVS$C008==\"4\"|WVS$C008==\"5\"])), by=list(WVS$S003[WVS$C008==\"4\"|WVS$C008==\"5\"]), FUN=length)\nWVS_High <- rename(WVS_High, c(Group.1=\"Country\", x=\"Four_Five_Work_Index\"))\nWVS_High<- WVS_High[order(WVS_High$Country),]\n###create index of one and two responses as proportion\nWVS_Low<-aggregate(as.numeric(as.character(WVS$C008[WVS$C008==\"1\"|WVS$C008==\"2\"])), by=list(WVS$S003[WVS$C008==\"1\"|WVS$C008==\"2\"]), FUN=length)\nWVS_Low <- rename(WVS_Low, c(Group.1=\"Country\", x=\"One_Two_Work_Index\"))\nWVS_Low<- WVS_Low[order(WVS_Low$Country),]\n#create a grand total\nWVS_All<-aggregate(as.numeric(as.character(WVS$C008[WVS$C008==\"1\"|WVS$C008==\"2\"|WVS$C008==\"3\"|WVS$C008==\"4\"|WVS$C008==\"5\"])), by=list(WVS$S003[WVS$C008==\"1\"|WVS$C008==\"2\"|WVS$C008==\"3\"|WVS$C008==\"4\"|WVS$C008==\"5\"]), FUN=length)\nWVS_All <- rename(WVS_All, c(Group.1=\"Country\", x=\"All\"))\nWVS_All<- WVS_All[order(WVS_All$Country),]\n#create a median\nWVS_Median<-aggregate(as.numeric(as.character(WVS$C008[WVS$C008==\"1\"|WVS$C008==\"2\"|WVS$C008==\"3\"|WVS$C008==\"4\"|WVS$C008==\"5\"])), by=list(WVS$S003[WVS$C008==\"1\"|WVS$C008==\"2\"|WVS$C008==\"3\"|WVS$C008==\"4\"|WVS$C008==\"5\"]), FUN=median)\nWVS_Median <- rename(WVS_Median, c(Group.1=\"Country\", x=\"Median\"))\nWVS_Median<- WVS_Median[order(WVS_Median$Country),]\n\n#now merge all together\nWVS_Work_Leisure_Scores<-merge(WVS_Work_Leisure_Scores, WVS_High, by=c(\"Country\"), all = TRUE)\nWVS_Work_Leisure_Scores<-merge(WVS_Work_Leisure_Scores, WVS_Low, by=c(\"Country\"), all = TRUE)\nWVS_Work_Leisure_Scores<-merge(WVS_Work_Leisure_Scores, WVS_All, by=c(\"Country\"), all = TRUE)\nWVS_Work_Leisure_Scores<-merge(WVS_Work_Leisure_Scores, WVS_Median, by=c(\"Country\"), all = TRUE)\n\n\nWVS_Work_Leisure_Scores$prop_high<-WVS_Work_Leisure_Scores$Four_Five_Work_Index/WVS_Work_Leisure_Scores$All\nWVS_Work_Leisure_Scores$prop_low<-WVS_Work_Leisure_Scores$One_Two_Work_Index/WVS_Work_Leisure_Scores$All\nWVS_Work_Leisure_Scores$high_prop_low<-WVS_Work_Leisure_Scores$Four_Five_Work_Index/WVS_Work_Leisure_Scores$One_Two_Work_Index\nWVS_Work_Leisure_Scores$median_mean<-WVS_Work_Leisure_Scores$Median/WVS_Work_Leisure_Scores$Work_Index\n\n#for future merging\nWVS_Work_Leisure_Scores$Country<-revalue(\n  WVS_Work_Leisure_Scores$Country,\n  c(\"Bosnia\"=\"Bosnia and Herzegovina\", \"Kyrgyzstan\"=\"Kyrgyz Republic\",\n    \"South Korea\"=\"Korea, Rep.\",\"Iran\"=\"Iran, Islamic Rep.\",\n    \"Russia\"=\"Russian Federation\", \"Macedonia\"=\"Macedonia, FYR\",\n    \"Egypt\"=\"Egypt, Arab Rep.\",\"Venezuela\"=\"Venezuela, RB\",\n    \"Czech Rep.\" = \"Czech Republic\", \"Viet Nam\" = \"Vietnam\",\n    \"Dominican Rep.\" = \"Dominican Republic\", \"Slovakia\" = \"Slovak Republic\"))\n\n#############################\n###########INFORMAL##########\n#############################\nchar_data <- read.csv(\"~/Downloads/case_informal.csv\", header = TRUE, stringsAsFactors = F)\nnum_data <- data.frame(data.matrix(char_data))\nnumeric_columns <- sapply(num_data,function(x){mean(as.numeric(is.na(x)))<0.5})\nfinal_data <- data.frame(num_data[,numeric_columns], char_data[,!numeric_columns])\nfinal_data<-rename(final_data, c(char_data....numeric_columns.=\"Country\"))\nisn_long<-reshape(final_data,\n                  varying = c(\"X1999\",\"X2000\",\"X2001\", \"X2002\", \"X2003\", \"X2004\",\"X2005\",\"X2006\", \"X2007\"),\n                  times = c(\"X1999\",\"X2000\",\"X2001\", \"X2002\", \"X2003\", \"X2004\",\"X2005\",\"X2006\", \"X2007\"),\n                  timevar = \"year\", direction=\"long\", idvar=\"Country\", v.names = \"Informal\")\nisn_long$Country<-revalue(isn_long$Country, c(\"Bosnia & Herzegovina\"=\"Bosnia and Herzegovina\"))\nisn_long<-rename(isn_long, c(year=\"Year\"))\n#prep Informal Sector for merge\nisn_long$Year <- gsub(\"X\", \"\", paste(isn_long$Year))\n\n#########################\n#####Ensure Merge########\n#########################\n###as revealed below, problem countries...see if this corrects\n\n#added data set for general econ data\ninternational_economic_data<-read.csv(\"/Users/Kevin/Downloads/international_economy.csv\", header = TRUE)\ninternational_economic_data$GDP.per.capita..constant.2005.US....NY.GDP.PCAP.KD.<-as.numeric(gsub(\",\", \"\", international_economic_data$GDP.per.capita..constant.2005.US....NY.GDP.PCAP.KD.))\ninternational_economic_data$GDP.growth..annual.....NY.GDP.MKTP.KD.ZG.<-as.numeric(gsub(\",\", \"\", international_economic_data$GDP.growth..annual.....NY.GDP.MKTP.KD.ZG.))\ninternational_economic_data$GDP.per.capita.growth..annual.....NY.GDP.PCAP.KD.ZG.<-as.numeric(gsub(\",\", \"\", international_economic_data$GDP.per.capita.growth..annual.....NY.GDP.PCAP.KD.ZG.))\ninternational_economic_data$GINI.index..World.Bank.estimate...SI.POV.GINI.<-as.numeric(gsub(\",\", \"\", international_economic_data$GINI.index..World.Bank.estimate...SI.POV.GINI.))\ninternational_economic_data$GDP..constant.2005.US....NY.GDP.MKTP.KD.<-as.numeric(gsub(\",\", \"\", international_economic_data$GDP..constant.2005.US....NY.GDP.MKTP.KD.))\ninternational_economic_data$Population..total..SP.POP.TOTL.<-as.numeric(gsub(\",\", \"\", international_economic_data$Population..total..SP.POP.TOTL.))\n\n#####\n####summary(as.numeric(international_economic_data$GDP.per.capita..constant.2005.US....NY.GDP.PCAP.KD.))\n#international_economic_data_test<-na.omit(international_economic_data[ ,c(\"Country\", \"Year\", \"GDP.per.capita..constant.2005.US....NY.GDP.PCAP.KD.\",\n# \"GDP..constant.2005.US....NY.GDP.MKTP.KD.\", \"GDP.per.capita.growth..annual.....NY.GDP.PCAP.KD.ZG.\")])\n\n#View(international_economic_data_test)\nnames(international_economic_data)[names(international_economic_data)==\"Time\"] <- \"Year\"\nnames(international_economic_data)[names(international_economic_data)==\"Country.Name\"] <- \"Country\"\n#now merge general econ into WVS\nWVS_Econ<-merge(WVS_Work_Leisure_Scores, international_economic_data, by = c(\"Country\"), all = TRUE)\n#unique(WVS_Informal_Econ$Country)\n#test_set<-na.omit(WVS_Econ[ ,c(\"Country\", \"Work_Index\", \"prop_high\", \"ISO\", \"Year\")])\n##Down to Taiwan only missing\n#unique(international_economic_data$Country)\n#unique(WVS_Work_Leisure_Scores$Country)\n#results1 = setdiff(WVS_Work_Leisure_Scores$Country, test_set$Country)\n#results1\n\nWVS_Econ_Informal<-merge(WVS_Econ, isn_long, by = c(\"Country\", \"Year\"), all = TRUE)\n#test_set<-na.omit(WVS_Econ_Informal[ ,c(\"Country\", \"Work_Index\", \"prop_high\", \"ISO\", \"GDP.growth..annual.....NY.GDP.MKTP.KD.ZG.\")])\n#note, drops Montenegro, Puerto Rico and Serbia from WVS...these do not exist in Informal\n#unique(isn_long$Country)\n#unique(WVS_Work_Leisure_Scores$Country)\n#results1 = setdiff(WVS_Work_Leisure_Scores$Country, test_set$Country)\n#results1\n#okay, tax data. this shit is key.\ninternational_tax_data<-read.csv(\"/Users/Kevin/Downloads/Merged-Table 1.csv\")\n#steps to merge, requires new names\n#head(international_tax_data)\nnames(international_tax_data)[names(international_tax_data)==\"Calendar.year..nearest.\"] <- \"Year\"\nWVS_Econ_Informal_Tax<-merge(WVS_Econ_Informal, international_tax_data, by = c(\"Country\", \"Year\"), all = TRUE)\n##okay....continue to only drop Taiwan\n#test_set<-na.omit(WVS_Econ_Informal_Tax[ ,c(\"Country\", \"Work_Index\", \"prop_high\", \"GDP.growth..annual.....NY.GDP.MKTP.KD.ZG.\", \"Income\")])\n#results1 = setdiff(WVS_Work_Leisure_Scores$Country, test_set$Country)\n#results1\n\n##add polity score\npolity<-read.csv(\"/Users/Kevin/Downloads/p4v2014.csv\")\n#head(polity)\npolity<-rename(polity, c(year=\"Year\", country=\"Country\"))\npolity$Country<-as.factor(polity$Country)\npolity$Country<-revalue(polity$Country, c(\"Bosnia\"=\"Bosnia and Herzegovina\", \"Kyrgyzstan\"=\"Kyrgyz Republic\", \"Korea South\"=\"Korea, Rep.\",\n                                          \"Iran\"=\"Iran, Islamic Rep.\", \"Russia\"=\"Russian Federation\", \"Macedonia\"=\"Macedonia, FYR\", \"Egypt\"=\"Egypt, Arab Rep.\",\n                                          \"Venezuela\"=\"Venezuela, RB\"))\n####NAME Doctor_Who since all of time and space... well...\nDoctor_Who<-merge(WVS_Econ_Informal_Tax, polity, by=c(\"Country\", \"Year\"), all = TRUE)\n#okay, appears no option but to drop Puerto Rico due to abscence from polity\n#test_set<-na.omit(Doctor_Who[ ,c(\"Country\", \"Work_Index\", \"prop_high\", \"GDP.growth..annual.....NY.GDP.MKTP.KD.ZG.\", \"Income\", \"polity2\")])\n#results1 = setdiff(WVS_Work_Leisure_Scores$Country, test_set$Country)\n#results1\n\n#######In sum, losing two cases in the WVS, Puerto Rico (no polity, but tax)\n###and Taiwan (polity, no tax). Only\n#possible good side, both are pretty middling in terms of work ethic scores\n\n################################\n####### The #### Dataverse #####\n#########Is now merged #########\n################################\n########Blimey##################\n\n####################################\n#####Create Suite of Variables######\n####################################\nDoctor_Who$Indiv_inc_prof<-as.numeric(sub(\"%\", \"\", Doctor_Who$Non.resource.component.of.taxes.on.income..profits..and.capital.gains))\nDoctor_Who$Income_Pro<-as.numeric(sub(\"%\", \"\", Doctor_Who$Income))\nDoctor_Who$Sales<-as.numeric(sub(\"%\", \"\", Doctor_Who$Taxes.on.goods.and.services..of.which.Taxes.on.Sales))\nDoctor_Who$Indiv_Sales<-Doctor_Who$Income_Pro/Doctor_Who$Sales\nDoctor_Who$Indiv_Sales[Doctor_Who$Indiv_Sales==\"Inf\"]<-NA\n#summary(Doctor_Who$Indiv_Sales)\n\nDoctor_Who$GDP_cap<-as.numeric(Doctor_Who$GDP.per.capita..constant.2005.US....NY.GDP.PCAP.KD.)\nDoctor_Who$GINI<-as.numeric(Doctor_Who$GINI.index..World.Bank.estimate...SI.POV.GINI.)\nDoctor_Who$Growth<-as.numeric(Doctor_Who$GDP.growth..annual.....NY.GDP.MKTP.KD.ZG.)\nDoctor_Who$UE<-as.numeric(Doctor_Who$Unemployment..total....of.total.labor.force...modeled.ILO.estimate...SL.UEM.TOTL.ZS.)\n\n\nDoctor_Who$agri<-as.numeric(gsub(\",\", \"\", Doctor_Who$Employment.in.agriculture....of.total.employment...SL.AGR.EMPL.ZS.))\n\nDoctor_Who$GDP<-as.numeric(Doctor_Who$GDP..constant.2005.US....NY.GDP.MKTP.KD.)\nDoctor_Who$Year<-as.numeric(Doctor_Who$Year)\nDoctor_Who$Informal<-as.numeric(Doctor_Who$Informal)\n#####polity dummy...update to literature recommendation of 6 cutoff\nDoctor_Who$polity_dummy<-as.numeric(Doctor_Who$polity2>5)\n####okay, these will be clutch for RDD\n###in all case go one year back from the date... then add number of lag... diff is how much higher/lower years forward is from one year back\nDoctor_Who$polity_change <- ave(Doctor_Who$polity2 , list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i)))\nDoctor_Who$polity_change_four<-as.numeric(Doctor_Who$polity_change>4|as.numeric(Doctor_Who$polity_change<4))\nDoctor_Who$polity_change_dum <- ave(Doctor_Who$polity_dummy , list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i)))\nDoctor_Who$become_democ<-as.numeric(Doctor_Who$polity_change_dum>0)\nDoctor_Who$become_dict<-as.numeric(Doctor_Who$polity_change_dum<0)\nDoctor_Who$polity_change_abs<-as.numeric(Doctor_Who$polity_change_dum!=0)\nDoctor_Who$polity_change_dum<-as.factor(Doctor_Who$polity_change_dum)\nDoctor_Who$dummy_direction_demo<-as.numeric(Doctor_Who$polity_change>0)\nDoctor_Who$dummy_direction_dict<-as.numeric(Doctor_Who$polity_change<0)\nDoctor_Who$weightings_polity_change<-Doctor_Who$polity_change/20\n\nDoctor_Who$one_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 1)))\nDoctor_Who$two_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 2)))\nDoctor_Who$three_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 3)))\nDoctor_Who$four_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 4)))\nDoctor_Who$five_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 5)))\nDoctor_Who$six_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 6)))\nDoctor_Who$seven_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 7)))\nDoctor_Who$eight_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 8)))\nDoctor_Who$nine_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 9)))\nDoctor_Who$ten_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 10)))\nDoctor_Who$eleven_yr_inc_change <- ave(Doctor_Who$Income_Pro, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 11)))\n\n###make some averages\n#find column numbers\n#which( colnames(Doctor_Who)==\"six_yr_inc_change\" )\n##make cross-row ave\nDoctor_Who$AVEfive_yr_inc_change<-rowMeans(Doctor_Who[,173:177],\n                                           na.rm = TRUE)\nDoctor_Who$one_yr_inc_change_IS <- ave(Doctor_Who$Indiv_Sales, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 1)))\nDoctor_Who$two_yr_inc_change_IS <- ave(Doctor_Who$Indiv_Sales, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 2)))\nDoctor_Who$three_yr_inc_change_IS <- ave(Doctor_Who$Indiv_Sales, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 3)))\nDoctor_Who$four_yr_inc_change_IS <- ave(Doctor_Who$Indiv_Sales, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 4)))\nDoctor_Who$five_yr_inc_change_IS <- ave(Doctor_Who$Indiv_Sales, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 5)))\nDoctor_Who$six_yr_inc_change_IS <- ave(Doctor_Who$Indiv_Sales, list(Doctor_Who$Country), FUN=function(i) c(NA,diff(i, lag = 6)))\n#which( colnames(Doctor_Who)==\"six_yr_inc_change_IS\" )\nDoctor_Who$AVEfive_yr_inc_changeIS<-rowMeans(Doctor_Who[,184:188],\n                                             na.rm = TRUE)\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n#NOTE: DANGEROUS TO CHANGE CODING ABOVE THIS POINT\n\nDoctor_Who$dem_high<-as.factor(Doctor_Who$polity_dummy==1 & Doctor_Who$prop_high>0.5)\n\n####\n####\n####\n####\n####\n#Will need to get institutions back in here\npolity<-read.csv(\"/Users/Kevin/Downloads/p4v2014.csv\")\n#head(polity)\npolity<-rename(polity, c(year=\"Year\", country=\"Country\"))\npolity$Country<-as.factor(polity$Country)\npolity$Country<-revalue(polity$Country, c(\"Bosnia\"=\"Bosnia and Herzegovina\", \"Kyrgyzstan\"=\"Kyrgyz Republic\", \"Korea South\"=\"Korea, Rep.\",\n                                          \"Iran\"=\"Iran, Islamic Rep.\", \"Russia\"=\"Russian Federation\", \"Macedonia\"=\"Macedonia, FYR\", \"Egypt\"=\"Egypt, Arab Rep.\",\n                                          \"Venezuela\"=\"Venezuela, RB\"))\n####NAME Doctor_Who since all of time and space... well...\nDoctor_Who<-merge(WVS_Econ_Informal_Tax, polity, by=c(\"Country\", \"Year\"), all = TRUE)\n\n\n\n\n##\n##\n##\n##\n\n\n\n\n\n\n\n\n\n#o <- rle(Doctor_Who$polity_change_dum)\n#sequence <- unlist(sapply(o$lengths, seq))\n#Doctor_Who$countzero <- sequence\n#Doctor_Who$countzero[Doctor_Who$polity_change_dum != 0] <- 0\n\n###could add a percent difference\n\nDoctor_Who$per_diff_after_6yr<-(Doctor_Who$six_yr_inc_change/Doctor_Who$Income_Pro)\n#Doctor_Who$sq_dir_polity<- Doctor_Who$polity_change_dum*sqrt(abs(Doctor_Who$polity_change))\nDoctor_Who$abs_dir_polity<- abs(Doctor_Who$polity_change)\n#Doctor_Who$exp_dir_polity<- Doctor_Who$polity_change_dum*(Doctor_Who$polity_change^2)\nDoctor_Who$cater_polity_d_WE<-NA\nDoctor_Who$cater_polity_d_WE[Doctor_Who$polity_change_dum==\"0\"]<-0\nDoctor_Who$cater_polity_d_WE[Doctor_Who$polity_change_dum==\"-1\"]<-1\nDoctor_Who$cater_polity_d_WE[Doctor_Who$polity_change_dum==\"1\"&Doctor_Who$prop_high<0.35]<-2\nDoctor_Who$cater_polity_d_WE[Doctor_Who$polity_change_dum==\"1\"&Doctor_Who$prop_high>0.35&Doctor_Who$prop_high<0.5]<-3\nDoctor_Who$cater_polity_d_WE[Doctor_Who$polity_change_dum==\"1\"&Doctor_Who$prop_high>0.5]<-4\nDoctor_Who$cater_polity_d_WE<-as.factor(Doctor_Who$cater_polity_d_WE)\n\nDoctor_Who$cater_polity_WE<-NA\nDoctor_Who$cater_polity_WE[Doctor_Who$polity_change==\"0\"]<-0\nDoctor_Who$cater_polity_WE[Doctor_Who$polity_change==\"-1\"]<-1\nDoctor_Who$cater_polity_WE[Doctor_Who$polity_change==\"1\"&Doctor_Who$prop_high<0.35]<-2\nDoctor_Who$cater_polity_WE[Doctor_Who$polity_change==\"1\"&Doctor_Who$prop_high>0.35&Doctor_Who$prop_high<0.5]<-3\nDoctor_Who$cater_polity_WE[Doctor_Who$polity_change==\"1\"&Doctor_Who$prop_high>0.5]<-4\nDoctor_Who$cater_polity_WE<-as.factor(Doctor_Who$cater_polity_WE)\n\nDoctor_Who$WE_Grouping<-0\nDoctor_Who$WE_Grouping[Doctor_Who$prop_high<0.35] <- \"1\"\nDoctor_Who$WE_Grouping[Doctor_Who$prop_high>=0.35 & Doctor_Who$prop_high<0.5] <- \"2\"\nDoctor_Who$WE_Grouping[Doctor_Who$prop_high>=0.5 & Doctor_Who$prop_high<1] <- \"3\"\nDoctor_Who$WE_Grouping<-as.factor(Doctor_Who$WE_Grouping)\n\n\nDoctor_Who$trip_dumm_dumm<-NA\nDoctor_Who$trip_dumm_dumm[Doctor_Who$polity_change_dum==\"0\"]<-0\nDoctor_Who$trip_dumm_dumm[Doctor_Who$polity_change_dum==\"-1\"]<-1\nDoctor_Who$trip_dumm_dumm[Doctor_Who$polity_change_dum==\"1\" & Doctor_Who$prop_high<0.48]<-2\nDoctor_Who$trip_dumm_dumm[Doctor_Who$polity_change_dum==\"1\" & Doctor_Who$prop_high>0.48]<-3\nDoctor_Who$trip_dumm_dumm<-as.factor(Doctor_Who$trip_dumm_dumm)\n\nDoctor_Who$relevel_dumm<-NA\nDoctor_Who$relevel_dumm[Doctor_Who$polity_change_dum==\"0\"]<-0\nDoctor_Who$relevel_dumm[Doctor_Who$polity_change_dum==\"-1\"]<-1\nDoctor_Who$relevel_dumm[Doctor_Who$polity_change_dum==\"1\"]<-2\nDoctor_Who$relevel_dumm<-as.factor(Doctor_Who$relevel_dumm)\n\n\n###need to fix\nDoctor_Who$trip_dumm<-NA\nDoctor_Who$trip_dumm[Doctor_Who$polity_change<4 & Doctor_Who$polity_change>(-4)]<-0\nDoctor_Who$trip_dumm[Doctor_Who$polity_change<(-4)]<-1\nDoctor_Who$trip_dumm[Doctor_Who$polity_change<(-4) & Doctor_Who$prop_high<0.5]<-2\nDoctor_Who$trip_dumm[Doctor_Who$polity_change>(4) & Doctor_Who$prop_high>0.5]<-3\nDoctor_Who$trip_dumm<-as.factor(Doctor_Who$trip_dumm)\nsummary(Doctor_Who$trip_dumm)\n\n\n###Doctor_Who$Final_Polity_Dum<-as.numeric(Doctor_Who$polity2>5[Doctor_Who$Year==2000])\n\n\n\n######\n######\n######\n######\n######\n######\n######\n######\n######\n\n####base lm correlation of country averages\ncountry_ave_2<-na.omit(Doctor_Who[, c(\"Country\", \"Year\", \"ISO.x\", \"Income_Pro\", \"GDP_cap\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\ncountry_ave_2x<-na.omit(Doctor_Who[, c(\"Country\", \"Year\", \"ISO.x\", \"Income_Pro\", \"GDP_cap\", \"prop_high\", \"Work_Index\", \"polity_dummy\", \"Informal\")])\nsummary(Doctor_Who$Informal)\nDoctor_Who$agri\n###appears solid for variety of subsets\n\n#country_ave_2<-subset(country_ave_2, Year>2000 & Year<2005)\n\ncountry_ave_2I<-aggregate(country_ave_2x[, 4:9], list(Country=country_ave_2x$ISO.x), mean)\ncountry_ave_2I$polity_dummy2<-as.numeric(country_ave_2I$polity_dummy>.5)\ncountry_ave_2I\n\nggplot(country_ave_2I, aes(prop_high, Income_Pro))+geom_point()+geom_text(aes(label=Country), size=3)+facet_wrap(~polity_dummy2) +\n  geom_smooth(method='lm',formula=y~x, show.legend = TRUE)\n\n#model 3 with interaction term for democracy\n#lm_work_2<-lm(Income_Pro~Work_Index*polity_dummy, data = country_ave_2I)\n#note, use prop_high\nlm_work_2<-lm(Income_Pro~prop_high*polity_dummy, data = country_ave_2I)\nsummary(lm_work_2)\n\n#first step... GDP/cap = development corrective\nlm_work_2a<-lm(Income_Pro~log(GDP_cap)+prop_high*polity_dummy, data = country_ave_2I)\nsummary(lm_work_2a, correlation = TRUE)\n\ncountry_ave_2I$Formal<-(100-country_ave_2I$Informal)/100\ncountry_ave_2I$Form_dum<-as.numeric(country_ave_2I$Formal<median(country_ave_2I$Formal))\n\n\n\ncountry_ave_2I$prop_high_dum<-as.numeric(country_ave_2I$prop_high>median(country_ave_2I$prop_high))\nmedian(country_ave_2I$Formal)\nlm_work_2a<-lm(Income_Pro~log(GDP_cap)+Informal*prop_high, data = country_ave_2I[country_ave_2I$polity_dummy2==\"1\",])\nsummary(lm_work_2a, correlation = TRUE)\n\n\nlm_work_3x<-lme(Income_Pro ~ 1 + Year + log(GDP_cap) + Informal*prop_high*polity_dummy,\n               random = ~ 1 + log(GDP_cap) + Year + polity_dummy|Country, data=Doctor_Who,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"))\nsummary(lm_work_3x)\n\n\n#note:\nplot(Income_Pro~log(GDP_cap), data = country_ave_2I)\n\n#now comtemplate a broader set of factors\n#country_ave_2I$polity_dummy2<-as.numeric(country_ave_2I$polity_dummy>.5)\ncountry_ave_2aa<-na.omit(Doctor_Who[, c(\"Country\", \"Year\", \"ISO.x\", \"Income_Pro\", \"GDP_cap\", \"prop_high\", \"GINI\", \"Informal\", \"Work_Index\", \"polity_dummy\")])\ncountry_ave_2Ia<-aggregate(country_ave_2aa[, 4:10], list(Country=country_ave_2aa$ISO.x), mean, rm.na = TRUE)\ncountry_ave_2Ia\n\nsummary(lm(Income_Pro~prop_high*polity_dummy+log(GDP_cap)+Informal+GINI, data = country_ave_2Ia), correlation = TRUE)\n\n#country_ave_2I$polity_dummy2<-as.numeric(country_ave_2I$polity_dummy>.5)\n\ncountry_ave_2a$cuts<-0\ncountry_ave_2a$cuts[country_ave_2a$polity_dummy>=0.5 & country_ave_2a$prop_high<0.48]<-1\ncountry_ave_2a$cuts[country_ave_2a$polity_dummy<0.5]<-2\ncountry_ave_2a$cuts[country_ave_2a$polity_dummy>=0.5 & country_ave_2a$prop_high>0.48]<-3\ncountry_ave_2a$cuts<-as.factor(country_ave_2a$cuts)\ncountry_ave_2a$cuts<-as.numeric(country_ave_2a$cuts)\ncountry_ave_2a\n\n#country_ave_2a<-subset(country_ave_2a, Year>1995 & Year<2000)\nsummary(country_ave_2a$Informal)\ncountry_ave_2Ia<-aggregate(country_ave_2a[, 4:10], list(Country=country_ave_2a$ISO.x), mean)\ncountry_ave_2Ia$polity_dummy2<-as.numeric(country_ave_2Ia$polity_dummy>.5)\ncountry_ave_2Ia\ncountry_ave_2Ia$cuts1<-0\ncountry_ave_2Ia$cuts1[country_ave_2Ia$cuts<1.5]<-1\ncountry_ave_2Ia$cuts1[country_ave_2Ia$cuts>1.5 & country_ave_2Ia$cuts<2.5]<-2\ncountry_ave_2Ia$cuts1[country_ave_2Ia$cuts>2.5]<-3\ncountry_ave_2Ia$cuts1<-as.factor(country_ave_2Ia$cuts1)\ncountry_ave_2Ia\nlm_work_2aa<-lm(Income_Pro~log(GDP_cap)+GINI+Informal+prop_high*cuts1, data = country_ave_2Ia)\nsummary(lm_work_2aa)\ncountry_ave_2Ia\nstargazer(lm_work_2, lm_work_2a, lm_work_2aa)\n\n##CAN also try\n\ncountry_ave_2I$polity_dummy2<-as.numeric(country_ave_2I$polity_dummy>.5)\ncountry_ave_2I$cuts<-0\ncountry_ave_2I$cuts[country_ave_2I$polity_dummy>=0.5 & country_ave_2I$prop_high<0.48]<-1\ncountry_ave_2I$cuts[country_ave_2I$polity_dummy<0.5]<-2\ncountry_ave_2I$cuts[country_ave_2I$polity_dummy>=0.5 & country_ave_2I$prop_high>0.48]<-3\ncountry_ave_2I$cuts<-as.factor(country_ave_2I$cuts)\ncountry_ave_2I$dem_high<-as.factor(country_ave_2I$prop_high>0.50&country_ave_2I$polity_dummy>.5)\n\nlm_work_2aaaa<-lm(Income_Pro~log(GDP_cap)+prop_high*cuts, data = country_ave_2I)\nsummary(lm_work_2aaaa)\n\n##\nDW_all<-subset(Doctor_Who, trip_dumm_dumm!=\"0\")\nDW_all<-na.omit(DW_all[, c(\"Country\", \"Year\", \"per_diff_after_6yr\", \"prop_high\", \"trip_dumm_dumm\", \"polity_dummy\")])\nlm_work_2aaa<-lm(per_diff_after_6yr~prop_high*trip_dumm_dumm, data = DW_all)\nsummary(lm_work_2aaa)\n\nplot(per_diff_after_6yr~prop_high, data = DW_all, col = as.factor(trip_dumm_dumm))\ntext(DW_all$prop_high, DW_all$per_diff_after_6yr, DW_all$Country, cex = .6)\n\nlegend(x=\"topright\", legend = levels(as.factor(DW_all$trip_dumm_dumm)), col=c(\"red\", \"black\", \"green\"), pch=1)\nabline(lm(Income_Pro[dummy_direction_dict==\"1\"]~prop_high[dummy_direction_dict==\"1\"], data = Doctor_Who_polity_delta_sensitivity11), col = \"black\")\nabline(lm(Income_Pro[dummy_direction_dict==\"0\" & prop_high< 0.5]~prop_high[dummy_direction_dict==\"0\" & prop_high< 0.5], data = Doctor_Who_polity_delta_sensitivity11), col = \"red\")\nabline(lm(Income_Pro[dummy_direction_dict==\"0\"& prop_high > 0.5]~prop_high[dummy_direction_dict==\"0\" & prop_high> 0.5], data = Doctor_Who_polity_delta_sensitivity11), col = \"red\")\n\n\nlm_work_2aaa<-lm(AVEfive_yr_inc_change[trip_dumm_dumm!=0]~prop_high[trip_dumm_dumm!=0]*trip_dumm_dumm[trip_dumm_dumm!=0], data = Doctor_Who)\nsummary(lm_work_2aaa)\n\n\ncountry_ave_3I<-aggregate(country_ave_2[, 3:7], list(Country=country_ave_2$Country, Year = country_ave_2$Year), mean)\nlm_work_3<-lme(per_diff_after_6yr ~ 1 + Year + GDP_cap + Work_Index*polity_dummy,\n               random = ~ 1 + GDP_cap + Year + Work_Index*polity_dummy|Country, data=country_ave_3I,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n               correlation=corAR1())\nsummary(lm_work_3)\n\n\nlm_work_3<-lme(per_diff_after_6yr ~ 1 + Year + GDP_cap + prop_high*polity_dummy,\n               random = ~ 1 + GDP_cap + Year + polity_dummy|Country, data=country_ave_3I,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n               correlation=corAR1())\n###\n\n#Category. Dictatorship\nDW_dict<-subset(Doctor_Who, trip_dumm_dumm==\"1\")\nDW_dict<-na.omit(DW_dict[, c(\"Country\", \"Year\", \"Income_Pro\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nDW_dict\nsummary(lm(Income_Pro ~  prop_high, data=DW_dict))\nDW_dict<-subset(Doctor_Who, trip_dumm_dumm==\"1\")\nDW_dict<-na.omit(DW_dict[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nsummary(lm(per_diff_after_6yr ~  prop_high, data=DW_dict))\nplot(per_diff_after_6yr ~  prop_high, data=DW_dict)\ntext(per_diff_after_6yr ~  prop_high, labels = Country, data=DW_dict)\n\nDoctor_Who$three_yr_inc_change\nDW_dict<-subset(Doctor_Who, trip_dumm_dumm==\"1\")\nDW_dict<-na.omit(DW_dict[, c(\"Country\", \"Year\", \"Income_Pro\", \"three_yr_inc_change\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nsummary(lm(three_yr_inc_change ~  prop_high, data=DW_dict))\nplot(three_yr_inc_change ~  prop_high, data=DW_dict)\ntext(three_yr_inc_change ~  prop_high, labels = Country, data=DW_dict)\n\n\n\nDW_dict<-subset(Doctor_Who, trip_dumm_dumm==\"1\")\nDW_dict<-na.omit(DW_dict[, c(\"Country\", \"Year\", \"Income_Pro\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nDW_dict\nsummary(lm(Income_Pro ~  prop_high, data=DW_dict))\nDW_dict<-subset(Doctor_Who, trip_dumm_dumm==\"1\")\nDW_dict<-na.omit(DW_dict[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nsummary(lm(per_diff_after_6yr ~  prop_high, data=DW_dict))\nplot(per_diff_after_6yr ~  prop_high, data=DW_dict)\ntext(per_diff_after_6yr ~  prop_high, labels = Country, data=DW_dict)\n\n\n?text\nDoctor_Who$per_diff_after_6yr\n\n\nsummary(lme(Income_Pro ~ 1 + prop_high,\n               random = ~ 1 |Country, data=DW_dict,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\n\n#Category. Democracy and Low\n\n\n\n\n\nDW_dem_low<-subset(Doctor_Who, trip_dumm_dumm==\"2\")\nDW_dem_low<-na.omit(DW_dem_low[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nsummary(lm(per_diff_after_6yr ~  prop_high, data=DW_dem_low))\nplot(per_diff_after_6yr ~  prop_high, data=DW_dem_low)\ntext(per_diff_after_6yr ~  prop_high, labels = Country, data=DW_dem_low)\n\n\n\n#Category. Democracy and High\nDW_dem_high<-subset(Doctor_Who, trip_dumm_dumm==\"3\")\nDW_dem_high<-na.omit(DW_dem_high[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nsummary(lm(per_diff_after_6yr ~  prop_high, data=DW_dem_high))\nplot(per_diff_after_6yr ~  prop_high, data=DW_dem_high)\ntext(per_diff_after_6yr ~  prop_high, labels = Country, data=DW_dem_high)\n\nDoctor_Who$AVEfive_yr_inc_change\nDW_dems<-subset(Doctor_Who, trip_dumm_dumm==\"2\"|trip_dumm_dumm==\"3\")\nper_diff_after_6yr\nDW_dems<-na.omit(DW_dems[, c(\"Country\", \"Year\", \"Income_Pro\", \"AVEfive_yr_inc_change\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nDW_dems\nlibrary(rdrobust)\nrdrobust(DW_dems$per_diff_after_6yr, DW_dems$prop_high, c = 0.48)\n\n\nrdrobust(Doctor_Who$Income_Pro, Doctor_Who$prop_high, c = 0.50)\n\nprop_rdd<-RDestimate(Income_Pro~prop_high, data=Doctor_Who, cutpoint = 0.50)\nprop_rdd<-RDestimate(AVEfive_yr_inc_change~prop_high, data=DW_dems, cutpoint = 0.50)\nplot(prop_rdd)\n?RDestimate\nsummary(prop_rdd)\n\n?rdrobust\nlibrary(rddtools)\n?rddtools\nrprop_rdd <- RDdata(y = DW_dems$six_yr_inc_change, x = DW_dems$prop_high, cutpoint = 0.48)\nrdplot(y = DW_dems$six_yr_inc_change, x = DW_dems$prop_high, cutpoint = 0.48)\nlibrary(rdd)\n?rdd\nprop_rdd<-RDestimate(six_yr_inc_change~prop_high, data=DW_dems, cutpoint = 0.48)\nsummary(prop_rdd)\nplot(prop_rdd)\n\n\n\ndem_rdd<-subset(Doctor_Who, polity_change>1)\nDW_dem_high<-na.omit(DW_dem_high[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\ndem_rdd<-na.omit(dem_rdd[,c(\"prop_high\", \"per_diff_after_6yr\")])\ndem_rdd\ndict_rdd<-subset(Doctor_Who, polity_change<0)\n\nprop_rdd<-RDestimate(per_diff_after_6yr~prop_high, data=dem_rdd, cutpoint = .49)\n\n\n######\n######\n######\n######\n######\n######\n######\n######\n######\n#Category. Dictatorship\nDW_fours<-subset(Doctor_Who, (Doctor_Who$polity_change>4 | Doctor_Who$polity_change<(-4)| Doctor_Who$polity2==\"NA\") & Doctor_Who$Year>1975)\nDW_fours<-na.omit(DW_fours[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nDW_fours\n\nsummary(lm(per_diff_after_6yr ~  prop_high, data=DW_dem_high))\nplot(per_diff_after_6yr ~  prop_high, data=DW_dem_high)\ntext(per_diff_after_6yr ~  prop_high, labels = Country, data=DW_dem_high)\n\n\nDW_total<-subset(Doctor_Who, (Doctor_Who$polity_change!=0| Doctor_Who$polity2==\"NA\") & Doctor_Who$Year>1975)\nDW_total<-na.omit(DW_total[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nDW_total\n\nDoctor_Who_Sub_Pol_Change_three\nDW_dict<-subset(Doctor_Who, trip_dumm_dumm==\"1\")\nDW_dict<-na.omit(DW_dict[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nDW_dict\nsummary(lm(Income_Pro ~  prop_high, data=DW_dict))\nDW_dict<-subset(Doctor_Who, trip_dumm_dumm==\"1\")\nDW_dict<-na.omit(DW_dict[, c(\"Country\", \"Year\", \"Income_Pro\", \"per_diff_after_6yr\", \"prop_high\", \"Work_Index\", \"polity_dummy\")])\nsummary(lm(per_diff_after_6yr ~  prop_high, data=DW_dict))\nplot(per_diff_after_6yr ~  prop_high, data=DW_dict)\ntext(per_diff_after_6yr ~  prop_high, labels = Country, data=DW_dict)\n\n\n\n\n\n\n\n\n\n\n\nDoctor_Who_Sub_Pol_Change_three<-subset(Doctor_Who, (Doctor_Who$polity_change>4 | Doctor_Who$polity_change<(-4)| Doctor_Who$polity2==\"NA\") & Doctor_Who$Year>1975)\n####\nggplot(Doctor_Who_Sub_Pol_Change_three, aes(prop_high, AVEfive_yr_inc_change))+geom_point()+facet_wrap(~polity_change_dum)+geom_text(aes(label=Country), size=3)\n###\nggplot(Doctor_Who_Sub_Pol_Change_three, aes(prop_high, Income_Pro))+geom_point()+facet_wrap(~polity_change_dum)+geom_text(aes(label=Country), size=3)\n###\nggplot(Doctor_Who_Sub_Pol_Change_three, aes(prop_high, two_yr_inc_change))+geom_point()+facet_wrap(~polity_change_dum)+geom_text(aes(label=Country), size=3)\n\nggplot(Doctor_Who_Sub_Pol_Change_three, aes(prop_high, AVEfive_yr_inc_change))+geom_point()+facet_wrap(~dummy_direction_demo)+geom_text(aes(label=Country), size=3)\n###\nggplot(Doctor_Who_Sub_Pol_Change_three, aes(prop_high, Income_Pro))+geom_point()+facet_wrap(~dummy_direction_demo)+geom_text(aes(label=Country), size=3)\n###\nggplot(Doctor_Who_Sub_Pol_Change_three, aes(prop_high, per_diff_after_6yr))+geom_point()+facet_wrap(~dummy_direction_demo)+geom_text(aes(label=Country), size=3)\nhead(Doctor_Who_Sub_Pol_Change_three)\n\n\n\n\n\n\n\nDoctor_Who_low<-Doctor_Who[Doctor_Who$prop_high<0.5,]\nsummary(lme(per_diff_after_6yr ~ 1 + Year + log(GDP_cap) + prop_high*trip_dumm_dumm,\n            random = ~1 + Year  |Country, data=Doctor_Who_low,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\nsummary(lme(per_diff_after_6yr ~ 1 + Year + prop_high*polity_change_four,\n            random = ~1 + Year |Country, data=Doctor_Who_low,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\n\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year + prop_high*polity_change_abs,\n            random = ~1 + Year |Country, data=Doctor_Who_high,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year + prop_high*polity_change_four,\n            random = ~1 + Year|Country, data=Doctor_Who_high,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\nDoctor_Who$prop_high_cutoff\n###\n###\nsummary(lme(six_yr_inc_change ~ 1 + Year + prop_high*as.factor(polity_change_dum)*prop_high_cutoff,\n            random = ~1 + Year |Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\nsummary(lme(six_yr_inc_change ~ 1 + Year + prop_high*as.factor(polity_change_dum)*prop_high_cutoff,\n            random = ~1 + Year |Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\nsummary(lme(six_yr_inc_change ~ 1 + Year + prop_high*as.factor(polity_change_dum)*prop_high_cutoff,\n            random = ~1 + Year |Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n####new route....\n####\n##\n#\n\n#\nsummary(lme(six_yr_inc_change ~ 1 + Year + prop_high*trip_dumm_dumm,\n            random = ~1 + Year + prop_high*trip_dumm_dumm|Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n#\n#\n#\n#\n\nsummary(lme(six_yr_inc_change ~ 1 + Year + prop_high*trip_dumm_dumm,\n            random = ~1 + Year + trip_dumm_dumm |Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\nsummary(lme(six_yr_inc_change ~ 1 + Year + prop_high*relevel_dumm,\n            random = ~1 + Year + prop_high*trip_dumm_dumm |Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year + prop_high*relevel_dumm,\n            random = ~1 + Year + prop_high*trip_dumm_dumm |Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year + prop_high*trip_dumm_dumm,\n            random = ~1 + Year + prop_high*trip_dumm_dumm |Country, data=Doctor_Who,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\")))\n#\n#\n\n#\n#########\nDoctor_Who_Sub_Pol_Change<-subset(Doctor_Who, (Doctor_Who$polity_change_dum!=0 | Doctor_Who$polity2==\"NA\") & Doctor_Who$Year>1975)\nDoctor_Who_Sub_Pol_Change\n#\n#\n#\nsummary(lm(AVEfive_yr_inc_change~prop_high*trip_dumm_dumm, data = Doctor_Who_Sub_Pol_Change))\nsummary(lm(AVEfive_yr_inc_change~prop_high*relevel_dumm, data = Doctor_Who_Sub_Pol_Change))\n#\n#\n#\n\n##########\nDoctor_Who_Sub_Pol_Change_alt_meth<-subset(Doctor_Who, (Doctor_Who$polity_change_dum!=0 | Doctor_Who$polity_change_dum==\"NA\") & Doctor_Who$Year>1975)\nunique(Doctor_Who_Sub_Pol_Change_alt_meth$Country)\nDoctor_Who_Sub_Pol_Change_alt_meth[,c(\"Country\",\"Year\",\"polity_change_dum\", \"Income_Pro\", \"AVEfive_yr_inc_change\", \"two_yr_inc_change\", \"six_yr_inc_change\", \"prop_high\")]\nDoctor_Who_Sub_Pol_Change_alt_meth\n\n##########\n\n####\nggplot(Doctor_Who_Sub_Pol_Change, aes(prop_high, AVEfive_yr_inc_change))+geom_point()+facet_wrap(~polity_change_dum)+geom_text(aes(label=Country), size=3)\n###\nggplot(Doctor_Who_Sub_Pol_Change, aes(prop_high, Income_Pro))+geom_point()+facet_wrap(~polity_change_dum)+geom_text(aes(label=Country), size=3)\n###\nggplot(Doctor_Who_Sub_Pol_Change, aes(prop_high, six_yr_inc_change))+geom_point()+facet_wrap(~polity_change_dum)+geom_text(aes(label=Country), size=3)\n\nggplot(Doctor_Who_Sub_Pol_Change, aes(prop_high, per_diff_after_6yr))+geom_point()+facet_wrap(~polity_change_dum)+geom_text(aes(label=Country), size=3)\n\n\nlisting_countries<-merge(Doctor_Who, Doctor_Who_Sub_Pol_Change, by = c(\"Country\"), all.y = FALSE)\nlisting_countries1<-na.omit(listing_countries[, c(\"Country\", \"Year.x\", \"Income_Pro.x\", \"prop_high.x\", \"Work_Index.x\", \"GDP_cap.x\", \"polity_dummy.x\", \"cater_polity_WE.x\", \"WE_Grouping.x\", \"countzero.x\")])\nggplot(listing_countries1, aes(Year.x, Income_Pro.x))+geom_point()+facet_wrap(~Country)\nggplot(listing_countries1, aes(Year.x, Income_Pro.x), colour = WE_Grouping.x)+geom_point()+facet_wrap(~polity_dummy.x)+scale_color_discrete(name = \"Work Ethic Grouping\")\n\nqplot(countzero.x, Income_Pro.x, data=listing_countries1, geom = c(\"smooth\"), colour=as.factor(WE_Grouping.x))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")+facet_wrap(~polity_dummy.x)+xlim(0, 20)\nqplot(Year.x, Income_Pro.x, data=listing_countries1, geom = c(\"smooth\"), colour=as.factor(Country))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")+facet_wrap(~WE_Grouping.x)\n\nqplot(Year.x, Income_Pro.x, data=listing_countries1, geom = c(\"smooth\"), colour=as.factor(WE_Grouping.x))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")+facet_wrap(~Country)\n\nlisting_countries1aaa<-na.omit(listing_countries[, c(\"Country\", \"Year.x\", \"six_yr_inc_change.x\", \"prop_high.x\", \"Work_Index.x\", \"GDP_cap.x\", \"polity_dummy.x\", \"cater_polity_WE.x\", \"WE_Grouping.x\", \"countzero.x\")])\nggplot(listing_countries1aaa, aes(prop_high.x, six_yr_inc_change.x), colour = WE_Grouping.x)+geom_point()+facet_wrap(~polity_dummy.x)+scale_color_discrete(name = \"Work Ethic Grouping\")\nDoctor_Who$six_yr_inc_change\n\n\n##\n##now create data set out of these countries... keeping full time series possible\n##\n\n\n#######################\n####base lm correlation of country averages\ncountry_ave_2<-na.omit(Doctor_Who[, c(\"Country\", \"Year\", \"Income_Pro\", \"prop_high\", \"Work_Index\", \"GDP_cap\", \"polity_dummy\")])\ncountry_ave_2I<-aggregate(country_ave_2[, 3:7], list(Country=country_ave_2$Country), mean)\n#model 3 with interaction term for democracy\nlm_work_2<-lm(Income_Pro~GDP_cap+Work_Index*polity_dummy, data = country_ave_2I)\nsummary(lm_work_2)\nstargazer(lm_work_2)\nggplot(country_ave_2I, aes(Work_Index, Income_Pro, color = polity_dummy))+geom_point()+geom_text(aes(label=Country), size=3)\nggplot(country_ave_2I, aes(prop_high, Income_Pro, color = polity_dummy))+geom_point()+geom_text(aes(label=Country), size=3)\n\ncountry_ave_3I<-aggregate(country_ave_2[, 3:7], list(Country=country_ave_2$Country, Year = country_ave_2$Year), mean)\nlm_work_3<-lme(Income_Pro ~ 1 + Year + GDP_cap + Work_Index*polity_dummy,\n               random = ~ 1 + GDP_cap + Year + Work_Index*polity_dummy|Country, data=country_ave_3I,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n               correlation=corAR1())\nsummary(lm_work_3)\n\n\ncountry_ave_4I<-aggregate(country_ave_2[, 3:6], list(Country=country_ave_2$Country, Year = country_ave_2$Year), mean)\nlm_work_4<-lme(Income_Pro ~ 1 + Year + GDP_cap + Work_Index*polity_dummy,\n               random = ~ 1 + GDP_cap + Year |Country, data=Doctor_Who,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n               correlation=corAR1())\nsummary(lm_work_4)\n###just wait, can I make whether a bump up or down in polity changes\n#income tax relative the country's intercept\ncountry_ave_5a<-na.omit(Doctor_Who[, c(\"Country\", \"Year\", \"Income_Pro\", \"prop_high\", \"Work_Index\", \"GDP_cap\", \"polity_dummy\", \"polity_change_dum\")])\ncountry_ave_5aI<-aggregate(country_ave_5a[, 3:8], list(Country=country_ave_5a$Country, Year = country_ave_5a$Year), mean)\n###\nlm_work_5a<-lme(Income_Pro ~ 1 + Year + GDP_cap + prop_high*polity_change_dum,\n               random = ~ 1 + GDP_cap + Year + polity_change_dum |Country, data=country_ave_5a,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n               correlation=corAR1())\nsummary(lm_work_5a)\n\ncountry_ave_5aa<-na.omit(Doctor_Who[, c(\"Country\", \"Year\", \"Income_Pro\", \"prop_high\", \"Work_Index\", \"GDP_cap\", \"polity_dummy\", \"cater_polity_WE\")])\ncountry_ave_5aaI<-aggregate(country_ave_5aa[, 3:8], list(Country=country_ave_5aa$Country, Year = country_ave_5aa$Year), mean)\nggplot(country_ave_5aa, aes(Year, Income_Pro))+geom_point()+facet_wrap(~cater_polity_WE) + geom_smooth(n = 3)\n\ncountry_ave_6a<-na.omit(Doctor_Who[, c(\"Country\", \"ISO.x\", \"Year\", \"six_yr_inc_change\", \"prop_high\", \"Work_Index\", \"polity_change_dum\", \"polity_change\", \"cater_polity_WE\")])\nlibrary(ggplot2)\n\nggplot(country_ave_6a, aes(prop_high, six_yr_inc_change))\nggplot(country_ave_6a, aes(prop_high, six_yr_inc_change))+geom_point()+facet_wrap(~cater_polity_WE) + geom_smooth(span = 1)\nggplot(country_ave_6a, aes(prop_high, six_yr_inc_change))+geom_point()+facet_wrap(~cater_polity_WE) + geom_smooth(span = .1)\nggplot(country_ave_6a, aes(Year, six_yr_inc_change))+geom_point()+facet_wrap(~cater_polity_WE) + geom_smooth(span = .3)\n\ncountry_ave_6aa<-na.omit(Doctor_Who[, c(\"Country\", \"ISO.x\", \"Year\", \"AVEfive_yr_inc_change\", \"prop_high\", \"Work_Index\", \"polity_change_dum\", \"polity_change\", \"cater_polity_WE\")])\nggplot(country_ave_6aa, aes(prop_high, AVEfive_yr_inc_change))+geom_point()+facet_wrap(~cater_polity_WE) + geom_smooth(span = .1)\n\n\n\ncountry_ave_7a<-na.omit(Doctor_Who[, c(\"Country\", \"ISO.x\", \"Year\", \"Income_Pro\", \"prop_high\", \"Work_Index\", \"polity_change_dum\", \"polity_change\", \"cater_polity_WE\")])\nggplot(country_ave_7a, aes(prop_high, Income_Pro))+geom_point()+facet_wrap(~cater_polity_WE) + geom_smooth(span = .3)\n\nDoctor_Who_gg_plot<-qplot(prop_high, six_yr_inc_change, data=country_ave_6a, geom_point()+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")\nDoctor_Who_gg_plot\n\n##\n##\n##\n##\n\nDoctor_Who$polity_change_dum\nDoctor_Who_GG_study<-Doctor_Who[Doctor_Who$polity_change_dum!=0 & Doctor_Who$Year>1980,]\nunique(Doctor_Who_GG_study$Country)\nDoctor_Who$RDD_Countries<-NA\nDoctor_Who$RDD_Countries[Doctor_Who$Country==Doctor_Who_GG_study$Country]<-Doctor_Who_GG_study$Country\nunique(Doctor_Who$RDD_Countries)\nDoctor_Who$RDD_Countries[Doctor_Who$Country==\"Liberia\"]\n\n#######################\n\nDoctor_Who_polity_delta<-Doctor_Who[Doctor_Who$polity_change!=0,]\nDoctor_Who_polity_delta<-na.omit(Doctor_Who_polity_delta[,c(\"Country\",\"Year\", \"Income_Pro\", \"AVEfive_yr_inc_change\", \"polity_change\", \"dummy_direction_dict\", \"polity_dummy\",\n                                                            \"weightings_polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_polity_delta$Year_gm<-Doctor_Who_polity_delta$Year-mean(Doctor_Who_polity_delta$Year)\nDoctor_Who_polity_delta$prop_high_gm<-Doctor_Who_polity_delta$prop_high-mean(Doctor_Who_polity_delta$prop_high)\nDoctor_Who_polity_delta$polity_change_gm<-Doctor_Who_polity_delta$polity_change-mean(Doctor_Who_polity_delta$polity_change)\nDoctor_Who_polity_delta$prop_adjusted<-0\nDoctor_Who_polity_delta$prop_adjusted[Doctor_Who_polity_delta$polity_dummy==\"0\"]<-Doctor_Who_polity_delta$prop_high[Doctor_Who_polity_delta$polity_dummy==\"0\"]\nDoctor_Who_polity_delta$prop_adjusted[Doctor_Who_polity_delta$polity_dummy==\"1\"]<-(Doctor_Who_polity_delta$prop_high[Doctor_Who_polity_delta$polity_dummy==\"1\"])^2\nDoctor_Who_polity_delta$prop_adjusted_gm<-Doctor_Who_polity_delta$prop_adjusted\n##plus sensitivity rounds...awesome results when just UE and GDP cap...shows they come to matter little in themselves but strengthen my relations\nDoctor_Who_polity_delta_sensitivity<-Doctor_Who[Doctor_Who$polity_change!=0,]\nDoctor_Who_polity_delta_sensitivity<-na.omit(Doctor_Who_polity_delta_sensitivity[,c(\"Country\",\"Year\", \"Income_Pro\", \"AVEfive_yr_inc_change\", \"polity_change\", \"dummy_direction_dict\", \"polity_dummy\", \"UE\", \"GDP_cap\", \"polity_change_dum\",\n                                                                                    \"weightings_polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_polity_delta_sensitivity$Year_gm<-Doctor_Who_polity_delta_sensitivity$Year-mean(Doctor_Who_polity_delta_sensitivity$Year)\nDoctor_Who_polity_delta_sensitivity$prop_high_gm<-Doctor_Who_polity_delta_sensitivity$prop_high-mean(Doctor_Who_polity_delta_sensitivity$prop_high)\nDoctor_Who_polity_delta_sensitivity$polity_change_gm<-Doctor_Who_polity_delta_sensitivity$polity_change-mean(Doctor_Who_polity_delta_sensitivity$polity_change)\nDoctor_Who_polity_delta_sensitivity$prop_adjusted<-0\nDoctor_Who_polity_delta_sensitivity$prop_adjusted[Doctor_Who_polity_delta_sensitivity$polity_dummy==\"0\"]<-Doctor_Who_polity_delta_sensitivity$prop_high[Doctor_Who_polity_delta_sensitivity$polity_dummy==\"0\"]\nDoctor_Who_polity_delta_sensitivity$prop_adjusted[Doctor_Who_polity_delta_sensitivity$polity_dummy==\"1\"]<-(Doctor_Who_polity_delta_sensitivity$prop_high[Doctor_Who_polity_delta_sensitivity$polity_dummy==\"1\"])^2\nDoctor_Who_polity_delta_sensitivity$prop_adjusted_gm<-Doctor_Who_polity_delta_sensitivity$prop_adjusted\n\n\n\n\n##########################################################\n#quickly, general LME...good sign...  robus to +/- \"UE\", \"GDP_cap\", \"GINI\"\nDoctor_Who_polity_delta_gen<-na.omit(Doctor_Who[,c(\"Country\",\"Year\", \"Income_Pro\", \"AVEfive_yr_inc_change\", \"polity_change\", \"dummy_direction_dict\", \"polity_dummy\", \"UE\", \"GDP_cap\", \"GINI\",\n                                                   \"weightings_polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_polity_delta_gen$Year_gm<-Doctor_Who_polity_delta_gen$Year-mean(Doctor_Who_polity_delta_gen$Year)\nDoctor_Who_polity_delta_gen$prop_high_gm<-Doctor_Who_polity_delta_gen$prop_high-mean(Doctor_Who_polity_delta_gen$prop_high)\nDoctor_Who_polity_delta_gen$polity_change_gm<-Doctor_Who_polity_delta_gen$polity_change-mean(Doctor_Who_polity_delta_gen$polity_change)\nDoctor_Who_polity_delta_gen$prop_adjusted<-0\nDoctor_Who_polity_delta_gen$prop_adjusted[Doctor_Who_polity_delta_gen$polity_dummy==\"0\"]<-Doctor_Who_polity_delta_gen$prop_high[Doctor_Who_polity_delta_gen$polity_dummy==\"0\"]\nDoctor_Who_polity_delta_gen$prop_adjusted[Doctor_Who_polity_delta_gen$polity_dummy==\"1\"]<-(Doctor_Who_polity_delta_gen$prop_high[Doctor_Who_polity_delta_gen$polity_dummy==\"1\"])^2\n###ISSUE\nDoctor_Who_polity_delta_gen$prop_adjusted_gm<-Doctor_Who_polity_delta_gen$prop_adjusted\n\n\n\n\n###\n####\n#####\n#Doctor_Who_polity_delta_gen_IS<-Doctor_Who[Doctor_Who$polity_change!=0,]\nDoctor_Who_polity_delta_gen_IS<-na.omit(Doctor_Who[,c(\"Country\",\"Year\", \"Indiv_Sales\", \"polity_change\", \"dummy_direction_dict\", \"polity_dummy\", \"GDP_cap\",\n                                                      \"weightings_polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\n\nDoctor_Who_polity_delta_gen_IS$prop_adjusted<-0\nDoctor_Who_polity_delta_gen_IS$prop_adjusted[Doctor_Who_polity_delta_gen_IS$polity_dummy==\"0\"]<-Doctor_Who_polity_delta_gen_IS$prop_high[Doctor_Who_polity_delta_gen_IS$polity_dummy==\"0\"]\nDoctor_Who_polity_delta_gen_IS$prop_adjusted[Doctor_Who_polity_delta_gen_IS$polity_dummy==\"1\"]<-(Doctor_Who_polity_delta_gen_IS$prop_high[Doctor_Who_polity_delta_gen_IS$polity_dummy==\"1\"])^2\nDoctor_Who_polity_delta_gen_IS$Indiv_Saleslog<-log(Doctor_Who_polity_delta_gen_IS$Indiv_Sales)\n\n\nsummary(lme(Indiv_Saleslog ~ 1 + Year + prop_adjusted*polity_change + GDP_cap,\n            random = ~1 + Year + polity_change + GDP_cap|Country, data=Doctor_Who_polity_delta_gen_IS,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\n\n####XCONST is a curious indicator too\n\n\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_adjusted_gm*polity_change_gm,\n            random = ~1 + Year_gm |Country, data=Doctor_Who_polity_delta_gen,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\n\n\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year_gm + UE + GDP_cap + GINI + prop_adjusted_gm*polity_change_gm,\n            random = ~1 + Year_gm + UE + GDP_cap + polity_change_gm |Country, data=Doctor_Who_polity_delta_gen,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\nDoctor_Who_polity_delta_gen<-na.omit(Doctor_Who[,c(\"Country\",\"Year\", \"Income_Pro\", \"AVEfive_yr_inc_change\", \"polity_change\", \"dummy_direction_dict\", \"polity_dummy\",\n                                                   \"weightings_polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_polity_delta_gen$Year_gm<-Doctor_Who_polity_delta_gen$Year-mean(Doctor_Who_polity_delta_gen$Year)\nDoctor_Who_polity_delta_gen$prop_high_gm<-Doctor_Who_polity_delta_gen$prop_high-mean(Doctor_Who_polity_delta_gen$prop_high)\nDoctor_Who_polity_delta_gen$polity_change_gm<-Doctor_Who_polity_delta_gen$polity_change-mean(Doctor_Who_polity_delta_gen$polity_change)\nDoctor_Who_polity_delta_gen$prop_adjusted<-0\nDoctor_Who_polity_delta_gen$prop_adjusted[Doctor_Who_polity_delta_gen$polity_dummy==\"0\"]<-Doctor_Who_polity_delta_gen$prop_high[Doctor_Who_polity_delta_gen$polity_dummy==\"0\"]\nDoctor_Who_polity_delta_gen$prop_adjusted[Doctor_Who_polity_delta_gen$polity_dummy==\"1\"]<-(Doctor_Who_polity_delta_gen$prop_high[Doctor_Who_polity_delta_gen$polity_dummy==\"1\"])^2\nDoctor_Who_polity_delta_gen$prop_adjusted_gm<-Doctor_Who_polity_delta_gen$prop_adjusted\n\n\n\n########Possibly what I have been looking for#############correlation=corAR1()\n###note the huge fucking difference that is adding a adjustment to treat democ and dict diff\n##can be ^2 or ^3 for democ... also, gm done after and can be included if desired\nsummary(lm(AVEfive_yr_inc_change~prop_high*polity_change, data = Doctor_Who_polity_delta))\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_adjusted_gm*polity_change_gm,\n            random = ~1 + Year_gm + polity_change_gm |Country, data=Doctor_Who_polity_delta,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\n\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_adjusted_gm*polity_change_gm,\n            random = ~1 + Year_gm  |Country, data=Doctor_Who_polity_delta,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\n##sens test...does not seem to hurt in any way\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year_gm + GDP_cap + UE + prop_adjusted_gm*polity_change_gm,\n            random = ~1 + Year_gm + GDP_cap + UE  + polity_change_gm |Country, data=Doctor_Who_polity_delta_sensitivity,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\n\n\n####some plots of polity change events\nDoctor_Who_polity_delta_sensitivity11<-Doctor_Who[Doctor_Who$polity_change!=0,]\nDoctor_Who_polity_delta_sensitivity11<-na.omit(Doctor_Who_polity_delta_sensitivity11[,c(\"Country\", \"ISO.x\", \"Year\", \"Income_Pro\", \"polity_change\", \"dummy_direction_dict\", \"polity_dummy\", \"polity_change_dum\",\n                                                                                        \"weightings_polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\n####\n####do diff colour if dem/dict\nplot(Income_Pro~prop_high, data = Doctor_Who_polity_delta_sensitivity11, col = as.factor(polity_dummy))\nlegend(x=\"topright\", legend = levels(as.factor(Doctor_Who_polity_delta_sensitivity11$polity_dummy)), col=c(\"red\",\"blue\"), pch=1)\nabline(lm(Income_Pro[polity_dummy==\"0\"]~prop_high[polity_dummy==\"0\"], data = Doctor_Who_polity_delta_sensitivity11), col = \"red\")\nabline(lm(Income_Pro[polity_dummy==\"1\"]~prop_high[polity_dummy==\"1\"], data = Doctor_Who_polity_delta_sensitivity11), col = \"black\")\n\nplot(Income_Pro~prop_high, data = Doctor_Who_polity_delta_sensitivity11, col = as.factor(polity_dummy))\nlegend(x=\"topright\", legend = levels(as.factor(Doctor_Who_polity_delta_sensitivity11$dummy_direction_dict)), col=c(\"red\",\"blue\"), pch=1)\nabline(lm(Income_Pro[dummy_direction_dict==\"0\" & prop_high< 0.5]~prop_high[dummy_direction_dict==\"0\" & prop_high< 0.5], data = Doctor_Who_polity_delta_sensitivity11), col = \"red\")\nabline(lm(Income_Pro[dummy_direction_dict==\"0\"& prop_high > 0.5]~prop_high[dummy_direction_dict==\"0\" & prop_high> 0.5], data = Doctor_Who_polity_delta_sensitivity11), col = \"red\")\nabline(lm(Income_Pro[dummy_direction_dict==\"1\"]~prop_high[dummy_direction_dict==\"1\"], data = Doctor_Who_polity_delta_sensitivity11), col = \"black\")\ntext(Doctor_Who_polity_delta_sensitivity11$prop_high,Doctor_Who_polity_delta_sensitivity11$Income_Pro,Doctor_Who_polity_delta_sensitivity11$ISO.x, cex = .6)\n\n\nplot(Income_Pro[polity_change<0]~prop_high[polity_change<0], data = Doctor_Who_polity_delta_sensitivity11)\nplot(Income_Pro[polity_change_dum<0]~prop_high[polity_change_dum<0], data = Doctor_Who_polity_delta_sensitivity11)\n\nplot(AVEfive_yr_inc_change~prop_high, data = Doctor_Who_polity_delta_sensitivity)\n\nplot(AVEfive_yr_inc_change[polity_change<0]~prop_high[polity_change<0], data = Doctor_Who_polity_delta_sensitivity)\nplot(AVEfive_yr_inc_change[polity_change_dum<0]~prop_high[polity_change_dum<0], data = Doctor_Who_polity_delta_sensitivity)\ntext(Doctor_Who_polity_delta_sensitivity$prop_high,Doctor_Who_polity_delta_sensitivity$AVEfive_yr_inc_change,Doctor_Who_polity_delta_sensitivity$Country, cex = .6)\n\nplot(AVEfive_yr_inc_change[polity_change>0]~prop_high[polity_change>0], data = Doctor_Who_polity_delta_sensitivity)\ntext(Doctor_Who_polity_delta_sensitivity$prop_high,Doctor_Who_polity_delta_sensitivity$AVEfive_yr_inc_change,Doctor_Who_polity_delta_sensitivity$Country, cex = .6)\n\nplot(AVEfive_yr_inc_change[polity_change_dum>0]~prop_high[polity_change_dum>0], data = Doctor_Who_polity_delta_sensitivity)\ntext(Doctor_Who_polity_delta_sensitivity$prop_high,Doctor_Who_polity_delta_sensitivity$AVEfive_yr_inc_change,Doctor_Who_polity_delta_sensitivity$Country, cex = .6)\n\n###woah....did this overfit somehow????\n##can include UE at fixed\nDoctor_Who_polity_delta_sensitivity$GDP_cap_gm<-Doctor_Who_polity_delta_sensitivity$GDP_cap-mean(Doctor_Who_polity_delta_sensitivity$GDP_cap_gm, na.rm = TRUE)\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year_gm + GDP_cap + prop_adjusted_gm*polity_change_gm,\n            random = ~1 + Year_gm +  prop_adjusted_gm*polity_change_gm |Country, data=Doctor_Who_polity_delta_sensitivity,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\nsummary(lme(AVEfive_yr_inc_change ~ 1 + Year_gm + GDP_cap + UE + prop_adjusted_gm*polity_change_gm,\n            random = ~1 + Year_gm + GDP_cap + UE + polity_change_gm |Country, data=Doctor_Who_polity_delta_sensitivity,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\n###cont alts\nlme_model_taxes<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_adjusted_gm*polity_change_gm,\n                     random = ~1 + Year_gm + polity_change_gm |Country, data=Doctor_Who_polity_delta,\n                     na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                     correlation=corAR1())\nsummary(lme_model_taxes)\nnull_lme_model_taxes<-lme(AVEfive_yr_inc_change ~ 1,\n                          random = ~1 |Country, data=Doctor_Who_polity_delta,\n                          na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                          correlation=corAR1())\n\nanova(null_lme_model_taxes, lme_model_taxes)\n##This is also a plausible model\nlme_model_taxes1<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + I(prop_high_gm^3)*polity_change_gm,\n                      random = ~1 + Year_gm +  + polity_change_gm |Country, data=Doctor_Who_polity_delta,\n                      na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                      correlation=corAR1())\nsummary(lme_model_taxes1)\n\n###note this case done for extra analysis...really not so bad\nlme_model_taxes1_resid<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_high_gm*polity_change_gm,\n                            random = ~1 +Year_gm + polity_change_gm|Country, data=Doctor_Who_polity_delta,\n                            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                            correlation=corAR1())\nsummary(lme_model_taxes1_resid)\nplot(lme_model_taxes1_resid)\nqqnorm(lme_model_taxes1, ~ranef(., level=1))\nlibrary(DAMisc)\nmod2<-lm(AVEfive_yr_inc_change~prop_adjusted_gm*cater_polity_WE , Doctor_Who)\ntrellis.par.set(\n  superpose.line = list(col=palette()[-1]),\n  superpose.polygon = list(col=palette()[-1]))\nintQualQuant(mod2, c(\"prop_adjusted_gm\", \"cater_polity_WE\"), type=\"slopes\", plot=T, rug=T)\nmod3<-lm(AVEfive_yr_inc_change~poly(prop_high,2)*polity_change , Doctor_Who_polity_delta)\nsummary(mod3)\nDAintfun(mod3, c(\"poly(prop_high,2)\",\"polity_change\"),\n         theta=-45, phi=20)\n\n\n###vs???\nplot(lme_model_taxes1)\n#\n#c(0, .1,.2,.3,.4,.5,.6,.7,.8,.9,1)\nlme_model_taxes_frame <- data.frame(\"prop_adjusted_gm*polity_change_gm\" = c(1,.2,.4,.9,1.6,2.5,3.6,4.9,6.4,8.1,10),\n                                    \"prop_adjusted_gm\" = c(0, .1,.2,.3,.4,.5,.6,.7,.8,.9,1),\n                                    \"polity_change_gm\" = -c(0, 1,2,3,4,5,6,7,8,9,10),\n                                    \"Year_gm\" = 0)\nlme_model_taxes_frame$pred_inc<-predict(lme_model_taxes, lme_model_taxes_frame, level = 0)\nplot(lme_model_taxes_frame$pred_inc~lme_model_taxes_frame$prop_adjusted_gm)\n\n###understanding the transformation I make\nplot(Doctor_Who_polity_delta1i$prop_adjusted~Doctor_Who_polity_delta1i$prop_high, xlim = c(0,1), ylim = c(0,1))\n\n\n#note...can slip into .05 without \"correlation=corAR1()\"... I don't think it should be\n#but maybe due to the proximity of some years.... also...I(prop_high^3) or ^2\n###########################################################\n##any way to build piecewise a linear relation for dictatorships and squared for demo???\n###########################################################\n\n####in fashion of RDD...works with bars at .3 and .7... but, note...need use pretty specific set up\n##does seem to hold though...as bars changed\n\n###even stronger now that focused!!!\nDoctor_Who_polity_delta1i<-Doctor_Who_polity_delta[Doctor_Who_polity_delta$prop_high>.35&Doctor_Who_polity_delta$prop_high<.65,]\nlme_model_taxes_rdd<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_adjusted_gm*polity_change_gm,\n                         random = ~1 + Year_gm +  + polity_change_gm |Country, data=Doctor_Who_polity_delta1i,\n                         na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                         correlation=corAR1())\nsummary(lme_model_taxes_rdd)\n\n\n\n#####can also now look at demo and dict seperately\n#as RDD\nDoctor_Who_polity_delta1<-Doctor_Who_polity_delta1i[Doctor_Who_polity_delta1i$dummy_direction_dict==\"0\",]\n#As full data\nDoctor_Who_polity_delta11<-Doctor_Who_polity_delta[Doctor_Who_polity_delta$dummy_direction_dict==\"0\",]\nlength(Doctor_Who_polity_delta1$Country)\n#okay, 85 democracies...now can swap delta1 and delta11 for rdd or not\n#note...with and without autocorr\nlme_model_taxes_demo<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_adjusted_gm*polity_change_gm,\n                          random = ~1 + Year_gm +  + polity_change_gm |Country, data=Doctor_Who_polity_delta11,\n                          na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                          correlation=corAR1())\nlme_model_taxes_demo<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_high*polity_change_gm,\n                          random = ~1 + Year_gm +  + polity_change_gm |Country, data=Doctor_Who_polity_delta1,\n                          na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                          correlation=corAR1())\n\nsummary(lme_model_taxes_demo)\n\n##Let's model for the half above and half below'..this uses full data on democ\n#this is not satisfying...not consistent with my theory of two positive slopes on each\n#side of fifty... but also not signifigant...not many cases at play\nDoctor_Who_polity_delta111<-Doctor_Who_polity_delta11[Doctor_Who_polity_delta11$prop_high<.5,]\nlme_model_taxes_lowerdemo<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_high*polity_change_gm,\n                               random = ~1 + Year_gm +  + polity_change_gm |Country, data=Doctor_Who_polity_delta111,\n                               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                               correlation=corAR1())\nsummary(lme_model_taxes_lowerdemo)\n\nDoctor_Who_polity_delta111i<-Doctor_Who_polity_delta11[Doctor_Who_polity_delta11$prop_high>.5,]\nlme_model_taxes_updemo<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_high*polity_change_gm,\n                            random = ~1 + Year_gm +  + polity_change_gm |Country, data=Doctor_Who_polity_delta111i,\n                            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                            correlation=corAR1())\nsummary(lme_model_taxes_updemo)\n\n\n##Let's model for the towards dictatorship moves...no sig...too few cases?\nDoctor_Who_polity_delta1111<-Doctor_Who_polity_delta[Doctor_Who_polity_delta$dummy_direction_dict==\"1\",]\nplot(Doctor_Who_polity_delta1111$AVEfive_yr_inc_change~Doctor_Who_polity_delta1111$prop_high)\nlme_model_taxes_dict<-lme(AVEfive_yr_inc_change ~ 1 + Year_gm + prop_high_gm,\n                          random = ~1 + Year_gm |Country, data=Doctor_Who_polity_delta1111,\n                          na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                          correlation=corAR1())\nsummary(lme_model_taxes_dict)\n###note on using change not actual rate/usage... pretty much, strip out country level idiosyncracies\n#just focus on change without incorporation of all the other things that clearly matter\n\n\n\n\nsummary(lme(Income_Pro ~ 1 + Year_gm + prop_high*polity_change,\n            random = ~1 + Year_gm |Country, data=Doctor_Who_polity_delta1,\n            na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n            correlation=corAR1()))\n\n\n\nsummary(lme(AVEfive_yr_inc_change~prop_high*polity_change, data = Doctor_Who_polity_delta1))\n\nsummary(lm(AVEfive_yr_inc_change~prop_high*polity_change, data = Doctor_Who_polity_delta1))\n\n\n\nlength(Doctor_Who_polity_delta$Country)\nDoctor_Who_polity_delta\nDoctor_Who_polity_delta\nDoctor_Who_pre_RDDII<-Doctor_Who_pre_RDD[Doctor_Who_pre_RDD$polity_change!=0,]\nDoctor_Who_pre_RDDII\n\nlength(Doctor_Who_polity_delta$Country)\n\ntest_lme_1<-lme(Income_Pro ~ 1 + Year + dummy_direction_demo*median_mean + dummy_direction_dict*prop_high,\n                random = ~1 + Year + dummy_direction_demo + dummy_direction_dict |Country, data=Doctor_Who,\n                na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                correlation=corAR1())\nsummary(test_lme_1)\n\ntest_lme_1<-lme(Income_Pro ~ 1 + Year + cater_polity_WE*exp(prop_high),\n                random = ~1 + Year |Country, data=Doctor_Who,\n                na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"))\nsummary(test_lme_1)\n\ntest_lm<-lm(Income_Pro ~ dummy_direction_demo*prop_high + dummy_direction_dict*prop_high, data = Doctor_Who)\n\ntest_lm<-lm(six_yr_inc_change ~ cater_polity_WE*prop_high, data = Doctor_Who)\n\ntest_lm<-lm(six_yr_inc_change ~ cater_polity_WE*sqrt(prop_high), data = Doctor_Who)\n\n\nsummary(test_lm)\n\n\n\n#Doctor_Who[Doctor_Who$Country==\"Germany\" & Doctor_Who$Year>1990,]\n\n##with added stress tests\nDoctor_Who_polity_delta_tests<-Doctor_Who[Doctor_Who$polity_change!=0,]\nDoctor_Who_polity_delta_tests<-na.omit(Doctor_Who_polity_delta_tests[,c(\"Country\",\"Year\", \"Income_Pro\", \"AVEfive_yr_inc_change\", \"polity_change\", \"dummy_direction_dict\", \"polity_dummy\", \"cater_polity_WE\",\n                                                                        \"weightings_polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\", \"Growth\", \"UE\", \"GDP_cap\", \"GINI\")])\nDoctor_Who_polity_delta_tests$Year_gm<-Doctor_Who_polity_delta_tests$Year-mean(Doctor_Who_polity_delta_tests$Year)\nDoctor_Who_polity_delta_tests$prop_high_gm<-Doctor_Who_polity_delta_tests$prop_high-mean(Doctor_Who_polity_delta_tests$prop_high)\nDoctor_Who_polity_delta_tests$polity_change_gm<-Doctor_Who_polity_delta_tests$polity_change-mean(Doctor_Who_polity_delta_tests$polity_change)\nDoctor_Who_polity_delta_tests$prop_adjusted<-0\nDoctor_Who_polity_delta_tests$prop_adjusted[Doctor_Who_polity_delta_tests$polity_dummy==\"0\"]<-Doctor_Who_polity_delta_tests$prop_high[Doctor_Who_polity_delta_tests$polity_dummy==\"0\"]\nDoctor_Who_polity_delta_tests$prop_adjusted[Doctor_Who_polity_delta_tests$polity_dummy==\"1\"]<-(Doctor_Who_polity_delta_tests$prop_high[Doctor_Who_polity_delta_tests$polity_dummy==\"1\"])^2\nDoctor_Who_polity_delta_tests$prop_adjusted_gm<-Doctor_Who_polity_delta_tests$prop_adjusted-mean(Doctor_Who_polity_delta_tests$prop_adjusted)\n\nlme_model_taxes_demo_stress_test<-lme(AVEfive_yr_inc_change ~ 1 + Growth + UE + GDP_cap + GINI + Year_gm + prop_adjusted_gm*polity_change_gm,\n                                      random = ~1 + Year_gm + Growth + UE + GDP_cap + GINI + polity_change_gm |Country, data=Doctor_Who_polity_delta_tests,\n                                      na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                                      correlation=corAR1())\nsummary(lme_model_taxes_demo_stress_test)\n\nlme_model_taxes_demo_stress_test<-lme(Income_Pro ~ 1 + Year_gm + prop_adjusted_gm*polity_change_gm,\n                                      random = ~1 + Year_gm   |Country, data=Doctor_Who_polity_delta_tests,\n                                      na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                                      correlation=corAR1())\nsummary(lme_model_taxes_demo_stress_test)\n\n\n\n################################\n################################\n######### The USSR #############\n################################\n################################\n\n####Potential redresses...must be 1990s data?... would kick out weird shit...phacking?\n\nUSSR_RDD<-\n  Doctor_Who[Doctor_Who$Country==\"Albania\"| Doctor_Who$Country==\"Azerbaijan\"|\n               Doctor_Who$Country==\"Armenia\"| Doctor_Who$Country==\"Bosnia and Herzegovina\"|\n               Doctor_Who$Country==\"Bulgaria\"| Doctor_Who$Country==\"Belarus\"|\n               Doctor_Who$Country==\"Croatia\"|\n               Doctor_Who$Country==\"Czech Republic\"|\n               Doctor_Who$Country==\"Estonia\"| Doctor_Who$Country==\"Georgia\"| Doctor_Who$Country==\"Hungary\"|\n               Doctor_Who$Country==\"Kyrgyz Republic\"|\n               Doctor_Who$Country==\"Latvia\"| Doctor_Who$Country==\"Lithuania\"|\n               Doctor_Who$Country==\"Moldova\"| Doctor_Who$Country==\"Montenegro\"|\n               Doctor_Who$Country==\"Romania\"|\n               Doctor_Who$Country==\"Russian Federation\"|\n               Doctor_Who$Country==\"Serbia\"| Doctor_Who$Country==\"Slovak Republic\"|\n               Doctor_Who$Country==\"Slovenia\"| Doctor_Who$Country==\"Ukraine\"|\n               Doctor_Who$Country==\"Macedonia, FYR\",]\nGG_USSR_Inc<-na.omit(USSR_RDD[,c(\"Country\",\"Year\", \"Income_Pro\",\n                                 \"Work_Index\", \"high_prop_low\", \"prop_high\")])\n\nsummary(GG_USSR_Inc$prop_high)\n###GG_USSR_Inc <-aggregate(USSR_RDD$Income_Pro, by=list(USSR_RDD$Country, USSR_RDD$Year), FUN=mean, na.rm=TRUE)\nGG_USSR_Inc$WE_Grouping<-0\nGG_USSR_Inc$WE_Grouping[GG_USSR_Inc$prop_high<0.35] <- \"1\"\nGG_USSR_Inc$WE_Grouping[GG_USSR_Inc$prop_high>=0.35 & GG_USSR_Inc$prop_high<0.5] <- \"2\"\nGG_USSR_Inc$WE_Grouping[GG_USSR_Inc$prop_high>=0.5 & GG_USSR_Inc$prop_high<1] <- \"3\"\n\nGG_USSR_Inc$WE_Grouping[GG_USSR_Inc$prop_high>=0.5 & GG_USSR_Inc$prop_high<0.65] <- \"4\"\nGG_USSR_Inc$WE_Grouping[GG_USSR_Inc$prop_high>=0.65] <- \"5\"\nsummary(as.factor(GG_USSR_Inc$WE_Grouping))\n#####syck plot\nGG_USSR_Inc_cater <-aggregate(GG_USSR_Inc$Income_Pro, by=list(GG_USSR_Inc$WE_Grouping, GG_USSR_Inc$Year), FUN=mean, na.rm=TRUE)\nGG_USSR_Inc_cater<-subset(GG_USSR_Inc_cater, Group.2>1992)\nGG_USSR_Inc_cater_plot<-qplot(Group.2, x, data=GG_USSR_Inc_cater, geom = c(\"point\", \"smooth\"), colour=Group.1)+geom_line()+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")\nGG_USSR_Inc_cater_plot\n\n\n\nGG_USSR_Inc<-subset(GG_USSR_Inc, Group.2>1985)\n\n##First not totally Shitty Graph Attempt\nhead(GG_USSR_Inc)\nlibrary(ggplot2)\nGG_USSR_Inc_plot<-qplot(Year, Income_Pro, data=GG_USSR_Inc, colour=Country)+geom_line()+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Country\")+facet_wrap(~WE_Grouping)\nGG_USSR_Inc_plot\n\n\n\nGG_USSR_Inc_high<-subset(GG_USSR_Inc, prop_high>0.5 & prop_high<0.8)\nGG_USSR_Inc_high_plot<-qplot(Year, Income_Pro, data=GG_USSR_Inc_high, colour=Country)+geom_line()+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Country\")\nGG_USSR_Inc_high_plot\nGG_USSR_Inc_low<-subset(GG_USSR_Inc, prop_high>0.4 & prop_high<0.5)\nGG_USSR_Inc_low_plot<-qplot(Year, Income_Pro, data=GG_USSR_Inc_low, colour=Country)+geom_line()+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Country\")\nGG_USSR_Inc_low_plot\n\n\nGG_USSR_Inc_rdd<-subset(GG_USSR_Inc, prop_high>0.4 & prop_high<0.6)\nGG_USSR_Inc_rdd\n\nGG_USSR_Inc_rdd_plot<-qplot(Year, Income_Pro, data=GG_USSR_Inc_rdd, colour=Country)+geom_line()+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Country\")\nGG_USSR_Inc_rdd_plot\n\nGG_USSR_Inc\nGG_USSR_Inc_lme<-lme(Income_Pro ~ 1 + Year*prop_high,\n                     random = ~1 + Year |Country, data=GG_USSR_Inc_rdd,\n                     na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                     correlation=corAR1())\nsummary(GG_USSR_Inc_lme)\n\nGG_USSR_Inc_lme<-lme(Income_Pro ~ 1 + Year + poly(prop_high,2),\n                     random = ~1 + Year |Country, data=GG_USSR_Inc,\n                     na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                     correlation=corAR1())\nsummary(GG_USSR_Inc_lme)\n\n##################\n### Income Tax###\n#################\nUSSR_RDD_sub\nUSSR_RDD_sub<-na.omit(USSR_RDD[,c(\"Country\",\"Year\", \"Income_Pro\", \"Growth\", \"UE\", \"GDP_cap\", \"GINI\",\n                                  \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nUSSR_RDD_sub$Work_Index_SQ<-USSR_RDD_sub$Work_Index^2\nUSSR_RDD_sub$prop_high_sq<-USSR_RDD_sub$prop_high^2\n\nUSSR_RDD_sub$dummy_WE<-as.numeric(USSR_RDD_sub$Work_Index>3.5)\nunique(USSR_RDD_sub$Country)\n\nunique(USSR_RDD_sub$Country)\ndescribe(USSR_RDD_sub$Work_Index)\nhist(USSR_RDD_sub$Work_Index, freq = TRUE)\ndescribe(USSR_RDD_sub$prop_high)\nhist(USSR_RDD_sub$prop_high, freq = TRUE)\n\nsummary(USSR_RDD_sub$Work_Index_SQ)\nplot(tapply(USSR_RDD_sub$Income_Pro, USSR_RDD_sub$Country, mean) ~ tapply(USSR_RDD_sub$Work_Index_SQ, USSR_RDD_sub$Country, mean))\nlm_USSR<-lm(tapply(USSR_RDD_sub$Income_Pro, USSR_RDD_sub$Country, mean) ~ tapply(USSR_RDD_sub$Work_Index, USSR_RDD_sub$Country, mean))\n\nsummary(lm_USSR)\nabline(lm_USSR)\n\n#####\n####\n###\nplot(tapply(USSR_RDD_sub$Income_Pro, USSR_RDD_sub$Country, mean) ~ tapply(USSR_RDD_sub$prop_high, USSR_RDD_sub$Country, mean), main = \"income taxes and proportion of high work ethic\", ylab = \"income tax\", xlab = \"prop high\")\nlm_USSR_II<-lm(tapply(USSR_RDD_sub$Income_Pro, USSR_RDD_sub$Country, mean) ~ tapply(USSR_RDD_sub$prop_high, USSR_RDD_sub$Country, mean))\nlm_USSR_II<-lm(tapply(USSR_RDD_sub$Income_Pro, USSR_RDD_sub$Country, mean) ~ tapply(USSR_RDD_sub$prop_high_sq, USSR_RDD_sub$Country, mean))\n\nlm_USSR_III<-lm(tapply(USSR_RDD_sub$Income_Pro, USSR_RDD_sub$Country, mean) ~ poly(tapply(USSR_RDD_sub$prop_high, USSR_RDD_sub$Country, mean), 2))\nabline(lm_USSR_II)\nsummary(lm_USSR_II)\nstargazer(lm_USSR_II)\n###works...prob have to justify the 3.75\naveUSSR_post<-tapply(USSR_RDD_sub$Work_Index, USSR_RDD_sub$Country, mean)\naveUSSR_post\n\nsummary(USSR_RDD_sub$Work_Index)\n#mean/median\nt.test(tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$Work_Index>3.6],\n              USSR_RDD_sub$Country[USSR_RDD_sub$Work_Index>3.6], median),\n       tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$Work_Index<3.6],\n              USSR_RDD_sub$Country[USSR_RDD_sub$Work_Index<3.6], median))\n\nt.test(tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$Work_Index_SQ>12.5],\n              USSR_RDD_sub$Country[USSR_RDD_sub$Work_Index_SQ>12.5], mean),\n       tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$Work_Index_SQ<12.5],\n              USSR_RDD_sub$Country[USSR_RDD_sub$Work_Index_SQ<12.5], mean))\n\n\nt.test(tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$Work_Index>3.75],\n              USSR_RDD_sub$Country[USSR_RDD_sub$Work_Index>3.75], mean),\n       tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$Work_Index<3.75],\n              USSR_RDD_sub$Country[USSR_RDD_sub$Work_Index<3.75], mean))\n\nt.test(tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high>.5],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high>.5], median),\n       tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high<.5],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high<.5], median))\n\nUSSR_RDD_sub$prop_high_sq\n\n\nUSSR_RDD$Taxes.on.income..profits..and.capital.gains.\n\nUSSR_RDD$Indiv_all<-as.numeric(USSR_RDD$Taxes.on.income..profits..and.capital.gains.)\nUSSR_RDD$Sales<-as.numeric(USSR_RDD$Taxes.on.goods.and.services..of.which.Taxes.on.Sales)\nUSSR_RDD$Inc_Sales<-USSR_RDD$Income_Pro/USSR_RDD$Sales\nUSSR_RDD_sub_ii<-na.omit(USSR_RDD[,c(\"Country\",\"Year\", \"Indiv_all\", \"Growth\", \"UE\", \"GDP_cap\", \"GINI\",\n                                     \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nt.test(tapply(USSR_RDD_sub_ii$Indiv_all[USSR_RDD_sub_ii$prop_high>.6],\n              USSR_RDD_sub_ii$Country[USSR_RDD_sub_ii$prop_high>.6], mean),\n       tapply(USSR_RDD_sub_ii$Indiv_all[USSR_RDD_sub_ii$prop_high<.6],\n              USSR_RDD_sub_ii$Country[USSR_RDD_sub_ii$prop_high<.6], mean))\nUSSR_RDD_sub_ii\nlm_USSR_II<-lm(tapply(USSR_RDD_sub_ii$Inc_Sales, USSR_RDD_sub_ii$Country, mean) ~ tapply(USSR_RDD_sub_ii$Inc_Sales, USSR_RDD_sub_ii$Country, mean))\nsummary(lm_USSR_II)\nUSSR_lme_is<-lme(Inc_Sales ~ 1 + year + high_prop_low,\n                 random = ~1 +year  |Country, data=USSR_RDD_sub_ii,\n                 na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                 correlation=corAR1())\nsummary(USSR_lme_is)\nplot(tapply(USSR_RDD_sub_ii$Inc_Sales, USSR_RDD_sub_ii$Country, mean) ~ tapply(USSR_RDD_sub_ii$prop_high, USSR_RDD_sub_ii$Country, mean), main = \"income taxes and proportion of high work ethic\", ylab = \"income tax\", xlab = \"prop high\")\n\n####\n####\n###\n\nt.test(tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high_sq>.15],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high_sq>.15], median),\n       tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high_sq<.15],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high_sq<.15], median))\n\n###\n###\n###\n\n\n\nt.test(tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high>.5],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high>.5], median),\n       tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high<.5],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high<.5], median))\n\nUSSR_lme_null<-lme(Income_Pro ~ 1,\n                   random = ~1|Country, data=USSR_RDD_sub,\n                   na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                   correlation=corAR1())\n\n#######\nUSSR_lme<-lme(Income_Pro ~ 1 + Growth + UE + GINI + log(GDP_cap)+ poly(prop_high,2),\n              random = ~1  + Growth + UE+ GINI + log(GDP_cap)|Country, data=USSR_RDD_sub,\n              na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n              correlation=corAR1())\nsummary(USSR_lme)\n####\n###\n###I think the poly nomial really captures around the 50% mark while allowing the tails to trail off\n##more flatly/with less commitment than the I(^2) which forces the tails downward (my theory\n##is agnostic about the tails I think)\nsummary(USSR_lme)\nUSSR_lme<-lme(Income_Pro ~ 1+ poly(prop_high, 2),\n              random = ~1  |Country, data=USSR_RDD_sub,\n              na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n              correlation=corAR1())\nUSSR_lme1<-lme(Income_Pro ~ 1+ I(prop_high^2),\n               random = ~1  |Country, data=USSR_RDD_sub,\n               na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n               correlation=corAR1())\nsummary(USSR_lme1)\n###\n##\n##\nUSSR_lme<-lme(Income_Pro ~ 1 + dummy_WE,\n              random = ~1 |Country, data=USSR_RDD_sub,\n              na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\nsummary(USSR_lme)\nanova(USSR_lme_null, USSR_lme)\n\n\nUSSR_lme_gm<-lme(Income_Pro~ 1+ Year_gm + agri_gm + log_GDP_gm + log_GDP_cap_gm +\n                   polity_dummy * Work_Index_gm, random = ~1 + Year_gm +\n                   log_GDP_cap_gm + agri_gm + polity_dummy |Country,\n                 data=tax_econ_polity_informal_WVS,\n                 na.action=na.omit, method=\"ML\",\n                 control=list(opt=\"optim\"), correlation=corAR1())\n\n\n\n###still to do\n#a t-test with restricted sample...\"proper\" RDD about .5\nUSSR_RDD_sub$prop_high_dem_quant<-cut(USSR_RDD_sub$prop_high, c(0, 0.2, 0.5, 0.8, 1), right=FALSE, ordered_result = TRUE, labels = c(\"first\", \"second\", \"third\", \"fourth\"))\n\naggregate(USSR_RDD_sub$Income_Pro, by = list(USSR_RDD_sub$prop_high_dem_quant), FUN = mean)\naggregate(USSR_RDD_sub$Income_Pro, by = list(USSR_RDD_sub$prop_high_dem_quant), FUN = median)\n\naggregate(USSR_RDD_sub$Income_Pro, by = list(USSR_RDD_sub$prop_high_dem_quant), FUN = count)\n\nt.test(tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high_dem_quant==\"second\"],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high_dem_quant==\"second\"], median),\n       tapply(USSR_RDD_sub$Income_Pro[USSR_RDD_sub$prop_high_dem_quant==\"third\"],\n              USSR_RDD_sub$Country[USSR_RDD_sub$prop_high_dem_quant==\"third\"], median))\n\n###general anova across all four categories\nsummary(aov(Income_Pro~prop_high_dem_quant, data = USSR_RDD_sub))\nhold<-aov(Income_Pro[USSR_RDD_sub$prop_high_dem_quant==\"second\"|USSR_RDD_sub$prop_high_dem_quant==\"third\"]~prop_high_dem_quant[USSR_RDD_sub$prop_high_dem_quant==\"second\"|USSR_RDD_sub$prop_high_dem_quant==\"third\"], data = USSR_RDD_sub)\nsummary(hold)\n\nUSSR_categor_null<-lme(Income_Pro ~ 1,\n                       random = ~1 |Country, data=USSR_RDD_sub,\n                       na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                       correlation=corAR1())\n#####could use to predict\nUSSR_categor<-lme(Income_Pro ~ 1 + prop_high_dem_quant,\n                  random = ~1 |Country, data=USSR_RDD_sub,\n                  na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                  correlation=corAR1())\nsummary(USSR_categor)\nanova(USSR_categor_null, USSR_categor)\n\n#a test that looks at diff in income tax use\nUSSR_RDD_sub_diff<-na.omit(USSR_RDD[,c(\"Country\",\"Year\", \"Income_Pro\", \"Growth\", \"UE\", \"GDP_cap\", \"GINI\",\n                                       \"Work_Index\", \"two_yr_inc_change\", \"high_prop_low\", \"prop_high\")])\n\nUSSR_RDD_sub_diff\nt.test(tapply(USSR_RDD_sub_diff$two_yr_inc_change[USSR_RDD_sub_diff$Work_Index>3.75],\n              USSR_RDD_sub_diff$Country[USSR_RDD_sub_diff$Work_Index>3.75], mean),\n       tapply(USSR_RDD_sub_diff$two_yr_inc_change[USSR_RDD_sub_diff$Work_Index<3.75],\n              USSR_RDD_sub_diff$Country[USSR_RDD_sub_diff$Work_Index<3.75], mean))\nt.test(tapply(USSR_RDD_sub_diff$two_yr_inc_change[USSR_RDD_sub_diff$Work_Index>3.5],\n              USSR_RDD_sub_diff$Country[USSR_RDD_sub_diff$Work_Index>3.5], median),\n       tapply(USSR_RDD_sub_diff$two_yr_inc_change[USSR_RDD_sub_diff$Work_Index<3.5],\n              USSR_RDD_sub_diff$Country[USSR_RDD_sub_diff$Work_Index<3.5], median))\n\n#a test that incorporates non-lin relation that I anticipate\n\n\n#attempt to account for backslides\n#\n#\nUSSR_RDD_sub_polity<-na.omit(USSR_RDD[,c(\"Country\",\"Year\", \"Income_Pro\", \"polity_dummy\", \"polity_change\",\n                                         \"dummy_direction_dict\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nUSSR_lme_bs_null<-lme(Income_Pro ~ 1,\n                      random = ~1 |Country, data=USSR_RDD_sub_polity,\n                      na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                      correlation=corAR1())\nUSSR_lme_bs_init<-lme(Income_Pro ~ 1+ poly(prop_high, 2),\n                      random = ~1 |Country, data=USSR_RDD_sub_polity,\n                      na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                      correlation=corAR1())\nUSSR_lme_bs<-lme(Income_Pro ~ 1+ poly(prop_high, 2)*polity_change,\n                 random = ~1 + dummy_direction_dict |Country, data=USSR_RDD_sub_polity,\n                 na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                 correlation=corAR1())\nsummary(USSR_lme_bs_init)\nsummary(USSR_lme_bs)\n\nanova(USSR_lme_bs_null, USSR_lme_bs)\n\nUSSR_lme_bs_frame <- data.frame(\"poly(prop_high, 2)*polity_change\" = 0,\n                                \"prop_high\" = c(.1,.2,.3,.4,.5,.6,.7,.8,.9,1),\n                                \"polity_change\" = 0)\nUSSR_lme_bs_frame$predinc<-predict(USSR_lme_bs, USSR_lme_bs_frame, level = 0)\nplot(USSR_lme_bs_frame$predinc~USSR_lme_bs_frame$prop_high, main = \"predicted income tax at level of prop_high\", xlab = \"prop_high\", ylab = \"predicted income taxes\")\n\n####################################\n### Now with indiv profits too #####\n####################################\n\nUSSR_RDD_Indic_sub<-na.omit(USSR_RDD[,c(\"Country\",\"Year\", \"Indiv_inc_prof\", \"Growth\", \"UE\", \"GDP_cap\", \"GINI\",\n                                        \"Work_Index\", \"high_prop_low\", \"prop_high\")])\n\nplot(tapply(USSR_RDD_Indic_sub$Indiv_inc_prof, USSR_RDD_Indic_sub$Country, mean) ~ tapply(USSR_RDD_Indic_sub$Work_Index, USSR_RDD_Indic_sub$Country, mean))\nlm_USSR_ind<-lm(tapply(USSR_RDD_Indic_sub$Indiv_inc_prof, USSR_RDD_Indic_sub$Country, mean) ~ tapply(USSR_RDD_Indic_sub$Work_Index, USSR_RDD_Indic_sub$Country, mean))\nsummary(lm_USSR_ind)\nabline(lm_USSR_ind)\nplot(tapply(USSR_RDD_Indic_sub$Indiv_inc_prof, USSR_RDD_Indic_sub$Country, mean) ~ tapply(USSR_RDD_Indic_sub$prop_high, USSR_RDD_Indic_sub$Country, mean))\nlm_USSRind_II<-lm(tapply(USSR_RDD_Indic_sub$Indiv_inc_prof, USSR_RDD_Indic_sub$Country, mean) ~ tapply(USSR_RDD_Indic_sub$prop_high, USSR_RDD_Indic_sub$Country, mean))\nsummary(lm_USSRind_II)\nabline(lm_USSRind_II)\n\nUSSR__ind_lme<-lme(Indiv_inc_prof ~ 1 + Growth + UE + log(GDP_cap) + GINI + poly(prop_high,2),\n                   random = ~1  + Growth + UE+ log(GDP_cap) + GINI|Country, data=USSR_RDD_Indic_sub,\n                   na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                   correlation=corAR1())\n\nUSSR__ind_lme<-lme(Indiv_inc_prof ~ 1 + Growth + UE + poly(prop_high,2),\n                   random = ~1  + Growth + UE|Country, data=USSR_RDD_Indic_sub,\n                   na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"),\n                   correlation=corAR1())\n\nsummary(USSR__ind_lme)\n\nt.test(tapply(USSR_RDD_Indic_sub$Indiv_inc_prof[USSR_RDD_Indic_sub$prop_high>.5],\n              USSR_RDD_Indic_sub$Country[USSR_RDD_Indic_sub$prop_high>.5], mean),\n       tapply(USSR_RDD_Indic_sub$Indiv_inc_prof[USSR_RDD_Indic_sub$prop_high<.5],\n              USSR_RDD_Indic_sub$Country[USSR_RDD_Indic_sub$prop_high<.5], mean))\n\n#######################\n#######################\n####### RDD ###########\n#######################\n#######################\nunique(Doctor_Who$polity2[Doctor_Who$Country==\"Algeria\"])\nWVS_Work_Leisure_Scores\n\nDoctor_Who$cater_polity<-as.factor(cut(Doctor_Who$polity_change, c(-20, -0.1, 0.1, 20), right=FALSE, ordered_result = TRUE, labels = c(\"dic_slid\", \"even\", \"dem_slid\")))\nlevels(Doctor_Who$cater_polity)\nDoctor_Who$cater_polity <- relevel(Doctor_Who$cater_polity, ref = \"even\")\n\ndoc_who_without_lme<-lme(AVEfive_yr_inc_change ~ 1 +  dummy_direction_dict*high_prop_low + dummy_direction_demo*poly(high_prop_low,2), random = ~ 1  + dummy_direction_demo + dummy_direction_dict|Country,\n                         data=Doctor_Who, na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\ndoc_who_without_lme<-lme(AVEfive_yr_inc_change ~ 1 +  polity_change*high_prop_low, random = ~ 1  + polity_change|Country,\n                         data=Doctor_Who, na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\nsummary(doc_who_without_lme)\nDoctor_Who$dummy_direction_demo<-as.numeric(Doctor_Who$polity_change>0)\nDoctor_Who$dummy_direction_dict<-as.numeric(Doctor_Who$polity_change<0)\nDoctor_Who$become_democ<-as.numeric(Doctor_Who$polity_change_dum>0)\nDoctor_Who$become_dict<-as.numeric(Doctor_Who$polity_change_dum<0)\n\n\n\n\n\n\n\n\n\ndoc_who_without_lme<-lme(three_yr_inc_change ~ 1 + Year + log(GDP_cap) + UE + prop_high*polity_change*polity_dummy, random = ~ 1 + Year + log(GDP_cap) + UE |Country,\n                         data=Doctor_Who_RDD,\n                         na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\n\n\ndoc_who_lme<-lme(three_yr_inc_change ~ 1 + Year + log(GDP_cap) + UE + prop_high*polity_change*polity_dummy, random = ~ 1 + Year + log(GDP_cap) + UE |Country,\n                 data=Doctor_Who_RDD,\n                 na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\n\nsummary(doc_who_lme)\n####another method....RESTOR TO .3 and .6\nDoctor_Who_pre_RDD<-Doctor_Who[Doctor_Who$prop_high>.4&Doctor_Who$prop_high<.6,]\nDoctor_Who_pre_RDDII<-Doctor_Who_pre_RDD[Doctor_Who_pre_RDD$polity_change!=0,]\nDoctor_Who_pre_RDDIII<-na.omit(Doctor_Who_pre_RDDII[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"six_yr_inc_change\", \"dummy_direction_demo\", \"polity_change\",\n                                                        \"Work_Index\", \"GDP_cap\", \"UE\", \"Growth\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_pre_RDDIII<-na.omit(Doctor_Who_pre_RDDII[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"dummy_direction_demo\", \"polity_change\",\n                                                        \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nplot(Doctor_Who_pre_RDDIII$six_yr_inc_change~Doctor_Who_pre_RDDIII$polity_change*Doctor_Who_pre_RDDIII$prop_high)\ntext(Doctor_Who_pre_RDDIII$prop_high, Doctor_Who_pre_RDDIII$six_yr_inc_change, Doctor_Who_pre_RDDIII$Country)\n###not sig... but really cool and telling...at .35 and .65...then near sig at .3 and .6\nDoctor_Who_pre_RDDI_lme<-lme(six_yr_inc_change ~ 1 + Year + dummy_direction_demo*high_prop_low, random = ~ 1  + Year + dummy_direction_demo|Country,\n                             data=Doctor_Who_pre_RDDIII, na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\n\nDoctor_Who_pre_RDDI_lme<-lme(six_yr_inc_change ~ 1 +  dummy_direction_demo*poly(prop_high, 2)+  Year, random = ~ 1 + dummy_direction_demo+  Year|Country,\n                             data=Doctor_Who_pre_RDDIII, na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\n\nDoctor_Who_pre_RDDI_lme<-lme(six_yr_inc_change ~ 1 +  Year + polity_change*poly(prop_high, 2), random = ~ 1  +polity_change+ Year |Country,\n                             data=Doctor_Who_pre_RDDIII, na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\n\nDoctor_Who_pre_RDDI_lme<-lme(six_yr_inc_change ~ 1 +  Year + polity_change*prop_high, random = ~ 1  +polity_change+ Year |Country,\n                             data=Doctor_Who_pre_RDDIII, na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\nt.test(Doctor_Who_pre_RDDIII$six_yr_inc_change[Doctor_Who_pre_RDDIII$high_prop_low>3], Doctor_Who_pre_RDDIII$six_yr_inc_change[Doctor_Who_pre_RDDIII$high_prop_low<3])\nt.test(Doctor_Who_pre_RDDIII$Income_Pro[Doctor_Who_pre_RDDIII$Work_Index>3.5 & Doctor_Who_pre_RDDIII$dummy_direction_demo==\"1\"], Doctor_Who_pre_RDDIII$Income_Pro[Doctor_Who_pre_RDDIII$Work_Index<3.5 & Doctor_Who_pre_RDDIII$dummy_direction_demo==\"1\"])\nt.test(Doctor_Who_pre_RDDIII$six_yr_inc_change[Doctor_Who_pre_RDDIII$high_prop_low>4 & Doctor_Who_pre_RDDIII$dummy_direction_demo==\"0\"], Doctor_Who_pre_RDDIII$six_yr_inc_change[Doctor_Who_pre_RDDIII$high_prop_low<4& Doctor_Who_pre_RDDIII$dummy_direction_demo==\"0\"])\n\nsummary(Doctor_Who_pre_RDDIII$high_prop_low[Doctor_Who_pre_RDDIII$dummy_direction_demo==\"1\"])\n\n\nsummary(Doctor_Who_pre_RDDI_lme)\n\nDoctor_Who_pre_RDDI_lm<-lm(six_yr_inc_change~polity_change*poly(prop_high, 3), data = Doctor_Who_pre_RDDIII)\nDoctor_Who_pre_RDDI_lm<-lm(six_yr_inc_change~polity_change*I(prop_high^1/3), data = Doctor_Who_pre_RDDIII)\n\nDoctor_Who_pre_RDDI_lm<-lm(Income_Pro~polity_change*poly(prop_high,3), data = Doctor_Who_pre_RDDIII)\nsummary(Doctor_Who_pre_RDDI_lm)\n\nDoctor_Who_pre_RDDIII\n\n\n###okay, diff method for same idea\n\nDoctor_Who_RDD<-Doctor_Who[Doctor_Who$polity_change!=0,]\nDoctor_Who_RDD_i<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"three_yr_inc_change\", \"polity_change_dum\",\n                                             \"Work_Index\", \"GDP_cap\", \"UE\", \"Growth\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_RDD_i<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"six_yr_inc_change\", \"polity_change_dum\",\n                                             \"Work_Index\", \"GDP_cap\", \"UE\", \"Growth\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_RDD_ii<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"polity_change\", \"dummy_direction_demo\",\n                                              \"Work_Index\", \"high_prop_low\", \"prop_high\", \"three_yr_inc_change\")])\n\n###GG_USSR_Inc <-aggregate(USSR_RDD$Income_Pro, by=list(USSR_RDD$Country, USSR_RDD$Year), FUN=mean, na.rm=TRUE)\nDoctor_Who_gg<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"polity_change\", \"dummy_direction_demo\", \"six_yr_inc_change\",\n                                          \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_RDD$AVEfive_yr_inc_change\nDoctor_Who_gg$WE_Grouping<-0\nDoctor_Who_gg$WE_Grouping[Doctor_Who_gg$prop_high<0.35] <- \"1\"\nDoctor_Who_gg$WE_Grouping[Doctor_Who_gg$prop_high>=0.35 & Doctor_Who_gg$prop_high<0.5] <- \"2\"\nDoctor_Who_gg$WE_Grouping[Doctor_Who_gg$prop_high>=0.5 & Doctor_Who_gg$prop_high<1] <- \"3\"\nsummary(as.factor(Doctor_Who_gg$dummy_direction_demo))\n\n#####syck plot\n##Doctor_Who_gg_plot <-aggregate(GG_USSR_Inc$Income_Pro, by=list(GG_USSR_Inc$WE_Grouping, GG_USSR_Inc$Year), FUN=mean, na.rm=TRUE)\n##GG_USSR_Inc_cater<-subset(GG_USSR_Inc_cater, Group.2>1992)\n#really interesting with three year change\nDoctor_Who_gg_plot<-qplot(prop_high, six_yr_inc_change, data=Doctor_Who_gg, geom = c(\"smooth\"), colour=as.factor(dummy_direction_demo))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")\nDoctor_Who_gg_plot\nDoctor_Who_gg_plot<-qplot(prop_high, Income_Pro, data=Doctor_Who_gg, geom = c(\"smooth\"), colour=as.factor(dummy_direction_demo))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")\n\n\n\nAVEfive_yr_inc_change\n\nDoctor_Who_RDD$AVEfive_yr_inc_changeIS\nDoctor_Who_gg_dis<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"become_democ\", \"eleven_yr_inc_change\",\n                                              \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_gg_dis\n#####three_yr_inc_change...AVEfive_yr_inc_change also interesting...two years\n#really cool with per_diff_after\n##bat man\nDoctor_Who_gg_dis_plot<-qplot(prop_high, per_diff_after, data=Doctor_Who_gg_dis, geom = c(\"smooth\"), colour=as.factor(become_democ))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")\nDoctor_Who_gg_dis_plot\nDoctor_Who_RDD$per_diff_after\nDoctor_Who_gg_dis<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"per_diff_after\", \"become_democ\",\n                                              \"Work_Index\", \"high_prop_low\", \"prop_high\")])\n\nDoctor_Who_RDD$AVEfive_yr_inc_change\nDoctor_Who_RDD$dummy_direction_demo\nDoctor_Who_RDD<-Doctor_Who[Doctor_Who$polity_change!=0,]\nDoctor_Who_RDD$per_diff_after\nDoctor_Who_gg_dis<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"countzero\", \"dummy_direction_demo\", \"six_yr_inc_change\", \"ten_yr_inc_change\", \"two_yr_inc_change\", \"AVEfive_yr_inc_change\",\n                                              \"polity_change\", \"Work_Index\", \"high_prop_low\", \"prop_high\")])\nDoctor_Who_gg_dis\nDoctor_Who_gg_dis<-Doctor_Who_gg_dis[Doctor_Who_gg_dis$Year>1980,]\nDoctor_Who_gg_dis<-Doctor_Who_gg_dis[Doctor_Who_gg_dis$polity_change<(-3)|Doctor_Who_gg_dis$polity_change>3,]\n\nDoctor_Who_gg_dis$WE_Grouping<-0\nDoctor_Who_gg_dis$WE_Grouping[Doctor_Who_gg_dis$prop_high<0.35] <- \"1\"\nDoctor_Who_gg_dis$WE_Grouping[Doctor_Who_gg_dis$prop_high>=0.35 & Doctor_Who_gg_dis$prop_high<0.5] <- \"2\"\nDoctor_Who_gg_dis$WE_Grouping[Doctor_Who_gg_dis$prop_high>=0.5 & Doctor_Who_gg_dis$prop_high<1] <- \"3\"\n\n\n\n\nDoctor_Who_ggcase<-Doctor_Who[Doctor_Who$Year>1980]\nDoctor_Who_gg_dis_plo_yrs<-qplot(prop_high, ten_yr_inc_change, data=Doctor_Who_gg_dis, geom = c(\"smooth\"), colour=as.factor(dummy_direction_demo))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")\nDoctor_Who_gg_dis_plo_yrs\n\nDoctor_Who_RDD1<-Doctor_Who[Doctor_Who$polity_change_dum!=0,]\nDoctor_Who_RDD1_1<-na.omit(Doctor_Who_RDD1[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"polity_change_dum\", \"six_yr_inc_change\",\n                                               \"polity_change\", \"Work_Index\", \"prop_high\")])\nDoctor_Who_RDD1_1\n\nsix_yr_inc_change_plot<-qplot(prop_high, six_yr_inc_change, data=Doctor_Who_RDD1_1, geom = c(\"smooth\"), colour=as.factor(polity_change_dum))+ggtitle(\"Income Taxes Percent Budget\")+labs(x=\"Year\",y=\"Income Taxes\")+scale_color_discrete(name = \"Work Ethic Grouping\")\nsix_yr_inc_change_plot\n\n\n\n\"six_yr_inc_change\", \"AVEfive_yr_inc_change\",\nplot(Doctor_Who_RDD_ii$Income_Pro~Doctor_Who_RDD_ii$prop_high)\nlength(unique(Doctor_Who_RDD$Country))\n\nlength(Doctor_Who_RDD_ii$Country)\n\n\n\n\n\n\n\n#### with and without poly\n#\n#\n#\nsummary(lm(Doctor_Who_RDD_ii$Income_Pro~poly(Doctor_Who_RDD_ii$prop_high,3)*Doctor_Who_RDD_ii$dummy_direction_demo))\ncase_works_trial<-(lm(Income_Pro~high_prop_low*dummy_direction_demo, data = Doctor_Who_RDD_ii))\nsummary(case_works_trial)\ncase_works_frame <- data.frame(\"dummy_direction_demo*high_prop_low\" = 0,\n                               \"dummy_direction_demo\" = 1,\n                               \"high_prop_low\" = c(0, 5,10,15,20,25,30,35,40,45))\ncase_works_frame$okay<-predict(case_works_trial, case_works_frame)\nplot(case_works_frame$okay~case_works_frame$high_prop_low)\n\n#\n#\n#\n####\nDoctor_Who_RDD_iii<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"polity_change\", \"dummy_direction_demo\", \"dummy_direction_dict\", \"Growth\", \"UE\", \"GDP_cap\",\n                                               \"Work_Index\", \"high_prop_low\", \"prop_high\", \"three_yr_inc_change\")])\nsummary(lm(Income_Pro~sqrt(high_prop_low)*dummy_direction_demo, data = Doctor_Who_RDD_iii))\nsummary(lm(Doctor_Who_RDD_ii$Income_Pro~poly(Doctor_Who_RDD_ii$prop_high, 3)*Doctor_Who_RDD_ii$dummy_direction_demo))\n\ncase_works<-(lm(Income_Pro~dummy_direction_demo*high_prop_low+GDP_cap+Growth, data = Doctor_Who_RDD_iii))\nsummary(case_works)\nsummary(Doctor_Who_RDD_ii$high_prop_low)\n\nDoctor_Who_RDD_iii\ntest_tri<-lm(Income_Pro~poly(prop_high,3)*dummy_direction_demo, data = Doctor_Who_RDD_iii)\nsummary(test_tri)\ncase_works_tri_frame <- data.frame(\"poly(prop_high,3)*dummy_direction_demo\" = .5,\n                                   \"prop_high\" = c(0, .1,.2,.3,.4,.5,.6,.7,.8,.9,1),\n                                   \"dummy_direction_demo\" = 1)\ncase_works_tri_frame$okay<-predict(test_tri, case_works_tri_frame)\nplot(case_works_tri_frame$okay~case_works_tri_frame$prop_high)\n\nplot(Income_Pro~prop_high, data=Doctor_Who_RDD_iii)\n\ntest_tri<-lm(Income_Pro~poly(prop_high,3)*dummy_direction_demo, data = Doctor_Who_RDD_iii)\n\n\n#\n#\n#\nUSSR_RDD_sub$prop_high_dem_quant<-\n\n  Doctor_Who_RDD_iii$catergor_polity<-cut(Doctor_Who_RDD_iii$polity_change, c(-20, -0.1, 0.1, 20), right=FALSE, ordered_result = TRUE, labels = c(\"dic_slid\", \"even\", \"dem_slid\"))\nboxplot(three_yr_inc_change~catergor_polity, data=Doctor_Who_RDD_iii)\ncase_works<-(lm(Income_Pro~dummy_direction_demo*high_prop_low+GDP_cap+Growth, data = Doctor_Who_RDD_iii))\n\ncase_works<-(lm(Income_Pro~dummy_direction_demo*poly(prop_high, 3), data = Doctor_Who_RDD_iii))\ncase_works<-(lm(Income_Pro~dummy_direction_demo*poly(prop_high, 2)+GDP_cap+Growth, data = Doctor_Who_RDD_iii))\nsummary(case_works)\n\n\n####\ncase_works<-(lm(Income_Pro~dummy_direction_demo*prop_high+GDP_cap+Growth, data = Doctor_Who_RDD_iii))\nsummary(case_works)\n####\n\n\n2.27*2000\n\nDoctor_Who_RDD_iiii<-na.omit(Doctor_Who_RDD[ ,c(\"Country\", \"Year\", \"Income_Pro\", \"polity_change\", \"high_prop_low\", \"prop_high\", \"three_yr_inc_change\")])\nt.test(Doctor_Who_RDD_iiii$Income_Pro[Doctor_Who_RDD_iiii$prop_high>median(Doctor_Who_RDD_iiii$prop_high)], Doctor_Who_RDD_iiii$Income_Pro[Doctor_Who_RDD_iiii$prop_high<median(Doctor_Who_RDD_iiii$prop_high)])\nDoctor_Who_RDD_iiii$prop_high_dem_quant<-cut(Doctor_Who_RDD_iiii$prop_high, c(0, 0.35, 0.5, 0.65, 1), right=FALSE, ordered_result = TRUE, labels = c(\"first\", \"second\", \"third\", \"fourth\"))\n\nboxplot(Income_Pro[dummy_direction_demo==\"1\"]~prop_high_dem_quant[dummy_direction_demo==\"1\"], data = Doctor_Who_RDD_iiii)\nboxplot(Income_Pro[polity_change>0]~prop_high_dem_quant[polity_change>0], data = Doctor_Who_RDD_iiii)\nboxplot(Income_Pro[polity_change<0]~prop_high_dem_quant[polity_change<0], data = Doctor_Who_RDD_iiii)\n\n\n###\"Growth\", \"UE\", \"GDP_cap\", \"GINI\",\ntax_econ_polity_informal_WVS$GDP_cap_gm<-tax_econ_polity_informal_WVS$GDP_cap-mean(tax_econ_polity_informal_WVS$GDP_cap, na.rm = TRUE)\ntax_econ_polity_informal_WVS$agri_gm<-tax_econ_polity_informal_WVS$agri-mean(tax_econ_polity_informal_WVS$agri, na.rm = TRUE)\ntax_econ_polity_informal_WVS$GDP_gm<-tax_econ_polity_informal_WVS$GDP-mean(tax_econ_polity_informal_WVS$GDP, na.rm = TRUE)\ntax_econ_polity_informal_WVS$Work_Index_gm<-tax_econ_polity_informal_WVS$Work_Index-mean(tax_econ_polity_informal_WVS$Work_Index, na.rm = TRUE)\ntax_econ_polity_informal_WVS$Year_gm<-tax_econ_polity_informal_WVS$Year-mean(tax_econ_polity_informal_WVS$Year, na.rm = TRUE)\ntax_econ_polity_informal_WVS$log_GDP_gm<-log(tax_econ_polity_informal_WVS$GDP)-mean(log(tax_econ_polity_informal_WVS$GDP), na.rm = TRUE)\ntax_econ_polity_informal_WVS$log_GDP_cap_gm<-log(tax_econ_polity_informal_WVS$GDP_cap)-mean(log(tax_econ_polity_informal_WVS$GDP_cap), na.rm = TRUE)\n\ndoc_who_lm<-lm(six_yr_inc_change~poly(prop_high, 2)*polity_change_dum, data = Doctor_Who_RDD_i)\ndoc_who_lm<-lm(six_yr_inc_change~prop_high*polity_change_dum, data = Doctor_Who_RDD_i)\n\ndoc_who_lm<-lm(six_yr_inc_change~prop_high*polity_change_dum+log(GDP_cap)+UE+Growth, data = Doctor_Who_RDD_i)\ndoc_who_II_lm<-lm(six_yr_inc_change~Work_Index*polity_change, data = Doctor_Who_RDD_ii)\n\nsummary(doc_who_lm)\nsummary(doc_who_II_lm)\n\ndoc_who_lme<-lme(three_yr_inc_change ~ 1 + Year + prop_high + polity_dummy+prop_high*polity_change, random = ~ 1 + Year |Country,\n                 data=Doctor_Who_RDD,\n                 na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\nsummary(doc_who_lme)\n\ndoc_who_lme<-lme(three_yr_inc_change ~ 1 + Year + log(GDP_cap) + UE + prop_high*polity_change*polity_dummy, random = ~ 1 + Year + log(GDP_cap) + UE |Country,\n                 data=Doctor_Who_RDD,\n                 na.action=na.omit, method=\"ML\", control=list(opt=\"optim\"), correlation=corAR1())\nsummary(doc_who_lme)\n\n",
    "created" : 1472703588879.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4161966761",
    "id" : "85178C0F",
    "lastKnownWriteTime" : 1472754562,
    "path" : "~/Documents/RDD_master_edited_Aug1.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}